<!doctype html><html lang=zh-cn itemscope itemtype=http://schema.org/WebPage><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>《Fast Data Processing with Spark 2（Third Edition)》读书笔记二 - Soul Mate</title><meta name=renderer content="webkit"><meta name=viewport content="width=device-width,initial-scale=1,user-scalable=yes"><meta name=MobileOptimized content="width"><meta name=HandheldFriendly content="true"><meta name=applicable-device content="pc,mobile"><meta name=theme-color content="#f8f5ec"><meta name=msapplication-navbutton-color content="#f8f5ec"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec"><meta name=mobile-web-app-capable content="yes"><meta name=author content="crazygit"><meta name=description content="本文主要介绍在Spark中加载和保存数据, 以及Spark的一些概念和Spark SQL查询
"><meta name=keywords content="Hugo,crazygit,blog"><meta name=baidu-site-verification content="mEI3NT6pyx"><meta name=google-site-verification content="AbF6G10N67H-FaerplTnvfAXJrTtXBGHdr4xsSot7z8"><meta name=generator content="Hugo 0.84.2"><link rel=canonical href=https://crazygit.wiseturtles.com/2018/01/15/fast-data-processing-with-spark2-note-two/><link rel=icon href=/favicon.ico><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=stylesheet href=/sass/jane.min.b3a8813c06e6d785beba22bf8264e174fa2cb3a396b22f9ba24e2c00c18aaf7f.css integrity="sha256-s6iBPAbm14W+uiK/gmThdPoss6OWsi+bok4sAMGKr38=" media=screen crossorigin=anonymous><meta property="og:title" content="《Fast Data Processing with Spark 2（Third Edition)》读书笔记二"><meta property="og:description" content="本文主要介绍在Spark中加载和保存数据, 以及Spark的一些概念和Spark SQL查询
"><meta property="og:type" content="article"><meta property="og:url" content="https://crazygit.wiseturtles.com/2018/01/15/fast-data-processing-with-spark2-note-two/"><meta property="article:section" content="post"><meta property="article:published_time" content="2018-01-15T17:45:35+08:00"><meta property="article:modified_time" content="2018-01-15T17:45:35+08:00"><meta itemprop=name content="《Fast Data Processing with Spark 2（Third Edition)》读书笔记二"><meta itemprop=description content="本文主要介绍在Spark中加载和保存数据, 以及Spark的一些概念和Spark SQL查询
"><meta itemprop=datePublished content="2018-01-15T17:45:35+08:00"><meta itemprop=dateModified content="2018-01-15T17:45:35+08:00"><meta itemprop=wordCount content="4383"><meta itemprop=keywords content="spark,"><meta name=twitter:card content="summary"><meta name=twitter:title content="《Fast Data Processing with Spark 2（Third Edition)》读书笔记二"><meta name=twitter:description content="本文主要介绍在Spark中加载和保存数据, 以及Spark的一些概念和Spark SQL查询
"><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script><script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]--><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','UA-112251188-1','auto'),ga('send','pageview'))</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body><div id=mobile-navbar class=mobile-navbar><div class=mobile-header-logo><a href=/ class=logo>Soul Mate</a></div><div class=mobile-navbar-icon><span></span><span></span><span></span></div></div><nav id=mobile-menu class="mobile-menu slideout-menu"><ul class=mobile-menu-list><li class=mobile-menu-item><a class=menu-item-link href=https://crazygit.wiseturtles.com/>主页</a></li><li class=mobile-menu-item><a class=menu-item-link href=https://crazygit.wiseturtles.com/categories/>分类</a></li><li class=mobile-menu-item><a class=menu-item-link href=https://crazygit.wiseturtles.com/post/>归档</a></li><li class=mobile-menu-item><a class=menu-item-link href=https://crazygit.wiseturtles.com/tags/>标签</a></li><li class=mobile-menu-item><a class=menu-item-link href=https://crazygit.wiseturtles.com/about/>关于</a></li></ul></nav><link rel=stylesheet href=/lib/photoswipe/photoswipe.min.css><link rel=stylesheet href=/lib/photoswipe/default-skin/default-skin.min.css><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><header id=header class="header container"><div class=logo-wrapper><a href=/ class=logo>Soul Mate</a></div><nav class=site-navbar><ul id=menu class=menu><li class=menu-item><a class=menu-item-link href=https://crazygit.wiseturtles.com/>主页</a></li><li class=menu-item><a class=menu-item-link href=https://crazygit.wiseturtles.com/categories/>分类</a></li><li class=menu-item><a class=menu-item-link href=https://crazygit.wiseturtles.com/post/>归档</a></li><li class=menu-item><a class=menu-item-link href=https://crazygit.wiseturtles.com/tags/>标签</a></li><li class=menu-item><a class=menu-item-link href=https://crazygit.wiseturtles.com/about/>关于</a></li></ul></nav></header><div id=mobile-panel><main id=main class="main bg-llight"><div class=content-wrapper><div id=content class="content container"><article class="post bg-white"><header class=post-header><h1 class=post-title>《Fast Data Processing with Spark 2（Third Edition)》读书笔记二</h1><div class=post-meta><time datetime=2018-01-15 class=post-time>2018-01-15</time><div class=post-category><a href=https://crazygit.wiseturtles.com/categories/spark/>spark</a></div><span class=more-meta>约 4383 字</span>
<span class=more-meta>预计阅读 9 分钟</span>
<span id=/2018/01/15/fast-data-processing-with-spark2-note-two/ class=leancloud_visitors data-flag-title="《Fast Data Processing with Spark 2（Third Edition)》读书笔记二"><span class=post-meta-item-text>| 阅读</span>
<span class=leancloud-visitors-count></span></span></div></header><div class=post-toc id=post-toc><h2 class=post-toc-title>文章目录</h2><div class=post-toc-content><nav id=TableOfContents><ul><li><a href=#在spark中加载和保存数据>在Spark中加载和保存数据</a><ul><li><a href=#spark抽象概念>Spark抽象概念</a></li><li><a href=#rdds>RDDs</a></li><li><a href=#数据形态>数据形态</a></li><li><a href=#数据形态和datasetsdataframesrdds>数据形态和<code>Datasets/DataFrames/RDDs</code></a></li><li><a href=#加载数据到rdd>加载数据到RDD</a></li><li><a href=#保存rdd数据>保存RDD数据</a></li></ul></li><li><a href=#spark20-概念>Spark2.0 概念</a><ul><li><a href=#data-hub>Data Hub</a></li><li><a href=#reporting-hub>Reporting Hub</a></li><li><a href=#analytics-hub>Analytics Hub</a></li><li><a href=#spark-full-stack>Spark Full Stack</a></li><li><a href=#大数据存储parquethttpsparquetapacheorg><a href=https://parquet.apache.org/>大数据存储Parquet</a></a></li></ul></li><li><a href=#spark-sql>Spark SQL</a><ul><li><a href=#单表查询>单表查询</a></li><li><a href=#多表查询>多表查询</a></li></ul></li></ul></nav></div></div><div class=post-content><p>本书其它笔记<a href=https://crazygit.wiseturtles.com/2018/01/26/fast-data-processing-with-spark2-note-index/>Fast Data Processing with Spark 2（Third Edition)》读书笔记目</a></p><h2 id=在spark中加载和保存数据>在Spark中加载和保存数据</h2><p>在我们开始操作数据之前，让我们先看一些Spark的概念以及了解一下不同的数据形态</p><h3 id=spark抽象概念>Spark抽象概念</h3><p>Saprk的主要特点就是分布式的数据描述(representation)和计算，因此拥有大规模的数据操作。<em>Spark主要的数据描述单元就是<code>RDD</code></em>(原句是: Spark&rsquo;s primary unit for representation of data is RDD)， 可以很方便的允许并行的数据计算。在Saprk 2.0.0版本之前，都是基于<code>RDDs</code>工作的。然而，它们都是低级别的原始结构，在执行和扩展上有很大的优化空间。因此才有了<code>Datasets/DataFrames</code>。<code>Datasets/DataFrames</code>是API级别的抽象，也是编程的主要接口，它提供了大量操作<code>RDD</code>, 但是通过优化查询计划在<code>RDDs</code>上封装了一层。因此，底层仍然是<code>RDD</code>, 只是通过<code>Datasets/DataFrames</code>的API来访问。</p><blockquote><p>RDDs can be viewed as arrays of arrays with primitive data types, such as integers, floats, and strings.</p><p>Datasets/DataFrames, on the other hand, are similar to a table or a spreadsheet with column headings-such as name, title, order number, order date, and movie rating-and the associated data types.</p></blockquote><p><code>RDDs</code>可以看做是一系列原始数据数组的集合，比如: 整型，浮点型和字符串。<code>Datasets/DataFrames</code>在另一方面来说，有点类似一张表单或表格，有许多列标题（比如姓名，标题，订单号，订单日期，电影评分）以及关联的数据类型。</p><p>无论在什么情况下。当使用<code>Datasets/DataFrames</code>,通过用<code>SparkSession</code>操作。然而，当需要进行一些低级别的操作来实复杂的计算或累加时，就是用<code>RDDs</code>,通过<code>SparkContext</code>来操作。</p><p>使用<code>dataset.rdd()</code>和<code>SparkSession.createDataset(rdd)/SparkSession.createDataFr ame(rdd)</code>方法，可以将<code>RDDs</code>转变为<code>Datasets/DataFrames</code>。</p><h3 id=rdds>RDDs</h3><p>我们可以使用任何Hadoop支持的数据源来创建<code>RDDs</code>。Scala, Java, Python语言的原始数据结构都可以作为<code>RDD</code>的基础。使用原始的数据集合创建<code>RDDs</code>在测试时非常有用。</p><p>由于<code>RDD</code>是懒加载，它只有在它被需要时才会去计算。也就是说：当你尝试从<code>RDD</code>获取数据时，可能会失败。<code>RDD</code>里的数据只有在被缓存引用或输出时才会通过计算创建，这也意味着你可以构造大量的计算而不用担心阻塞计算线程。甚至，只有当你在具体化<code>RDD</code>（materialize the RDD）时，代码才会去加载原始数据。</p><p><strong>Tips</strong>:</p><p>每次你具体化<code>RDD</code>时，它都会计算一次。因此，当频繁的使用时，可以借助缓存机制来提高效率。</p><h3 id=数据形态>数据形态</h3><p>从数据形态的角度来说，所有的数据可以分成三类</p><ul><li><p><strong>结构化的数据（Structured data</strong>），通常存储在数据库里，如Oracle, HBase, Cassandra等，关系型数据库是最常见的结构化数据的存储方式。结构化的数据样式，数据类型和数据大小都是已知的。</p></li><li><p><strong>半结构化的数据（Semi-structured data）</strong>，
正如它的名字一样，它也是有结构的数据，只是数据样式，数据类型和数据大小是可变。常见的半结构化数据格式有:<code>csv</code>, <code>json</code>和<code>parquet</code></p></li><li><p><strong>无结构的数据（Unstructured data）</strong>，目前我们遇到的85%的数据都是这种格式。如图形，音频文件，社交文化等。大部分的数据处理，都是从无结构的数据开始，通过ETL(Extract-Transform-Load)，变型和其它技术，最终变成结构化的数据。</p></li></ul><h3 id=数据形态和datasetsdataframesrdds>数据形态和<code>Datasets/DataFrames/RDDs</code></h3><p>现在让我们结合数据形态以及spark的抽象概念来看看如何使用spark读写数据。</p><p>在Spark 2.0.0之前，我们只需要使用<code>RDDs</code>和<code>map()</code>函数来按照需要改变数据。但是，当使用<code>Dataset/DataFrame</code>, 变得稍微复杂一些， 我们可以直接读入类似一张表的数据，包含数据类型和列信息，也可以更高效的工作。</p><p>通常来说:</p><ol><li><p>使用<code>SparkContext</code>和<code>RDDs</code>来处非无结构的数据</p></li><li><p>使用<code>SparkSession</code>和<code> Datasets/DataFrames</code>来处理结构化和半结构化的数据。<code>SparkSession</code>有统一的标准处理各种格式的数据，如: <code>.csv</code>, <code>.json</code>, <code>.parquet</code>, <code>.jdbc</code>, <code>.orc</code>。还有一个可插拔的结构叫做<code>DataSource API</code>, 可以处理任意类型的结构化数据</p></li></ol><h3 id=加载数据到rdd>加载数据到RDD</h3><p>创建RDD最简单的方式就是使用编程语言(Scala, Python, Java)原始的数据结构，
<code>SparkContext</code>对象有个方法<code>parallelize</code>可以实现这个功能。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>&gt;&gt;&gt;</span> rdd <span style=color:#f92672>=</span> sc<span style=color:#f92672>.</span>parallelize([<span style=color:#ae81ff>1</span>,<span style=color:#ae81ff>2</span>,<span style=color:#ae81ff>3</span>])

<span style=color:#f92672>&gt;&gt;&gt;</span> rdd<span style=color:#f92672>.</span>take(<span style=color:#ae81ff>3</span>)
[<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span>]
</code></pre></td></tr></table></div></div><p>加载外部数据最简单的方式就是读取一个文本文件。如果是单机模式的话，这个很简单，主要确保文件在本机即可。但是在集群环境下时需要注意，文件需要存在集群上的每个节点上，在分布式环境下，我们可以使用<code>addFile</code>方法，让Spark把文件拷贝到集群的每个机器上，如:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>&gt;&gt;&gt;</span> <span style=color:#f92672>from</span> pyspark.files <span style=color:#f92672>import</span> SparkFiles

<span style=color:#f92672>&gt;&gt;&gt;</span> sc<span style=color:#f92672>.</span>addd(<span style=color:#e6db74>&#34;data/spam.data&#34;</span>)

<span style=color:#f92672>&gt;&gt;&gt;</span> sc<span style=color:#f92672>.</span>addFile(<span style=color:#e6db74>&#34;data/spam.data&#34;</span>)

<span style=color:#f92672>&gt;&gt;&gt;</span> in_file <span style=color:#f92672>=</span> sc<span style=color:#f92672>.</span>textFile(SparkFiles<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#34;spam.data&#34;</span>))

<span style=color:#f92672>&gt;&gt;&gt;</span> in_file<span style=color:#f92672>.</span>take(<span style=color:#ae81ff>1</span>)
[<span style=color:#e6db74>u</span><span style=color:#e6db74>&#39;0 0.64 0.64 0 0.32 0 0 0 0 0 0 0.64 0 0 0 0.32 0 1.29 1.93 0 0.96 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.778 0 0 3.756 61 278 1&#39;</span>]
</code></pre></td></tr></table></div></div><p>通常，我们输入的文件都是CSV或TSV文件。一般在创建RDDs时，都需要先解析数据。
通常有两种做法:</p><ol><li>自己写函数读取和解析CSV文件</li><li>使用第三库，比如<code>opencsv</code></li></ol><p>我们看看自己写函数的方式</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>&gt;&gt;&gt; !cat data/Line_of_numbers.csv
42,42,55,61,53,49,43,47,49,60,68,54,34,35,35,39
&gt;&gt;&gt; inp_file = sc.textFile(&#34;data/Line_of_numbers.csv&#34;)

&gt;&gt;&gt; numbers_rdd = inp_file.map(lambda line: line.split(&#39;,&#39;))

&gt;&gt;&gt; numbers_rdd.take(10)
[[u&#39;42&#39;,
  u&#39;42&#39;,
  u&#39;55&#39;,
  u&#39;61&#39;,
  u&#39;53&#39;,
  u&#39;49&#39;,
  u&#39;43&#39;,
  u&#39;47&#39;,
  u&#39;49&#39;,
  u&#39;60&#39;,
  u&#39;68&#39;,
  u&#39;54&#39;,
  u&#39;34&#39;,
  u&#39;35&#39;,
  u&#39;35&#39;,
  u&#39;39&#39;]]
</code></pre></td></tr></table></div></div><p>得到的数据都是字符串类型，我们希望把它转换为整型或浮点型</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>&gt;&gt;&gt; numbers_rdd = inp_file.flatMap(lambda line:
...            line.split(&#39;,&#39;)).map(lambda x:float(x))
...

&gt;&gt;&gt; numbers_rdd.take(10)
[42.0, 42.0, 55.0, 61.0, 53.0, 49.0, 43.0, 47.0, 49.0, 60.0]

&gt;&gt;&gt; numbers_sum = numbers_rdd.sum()

&gt;&gt;&gt; numbers_sum
766.0
</code></pre></td></tr></table></div></div><p>注意上面解析文件时先使用的是<code>flatMap</code>，再使用的<code>map</code>。<code>flatMap</code>会将结果变成数组</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>&gt;&gt;&gt; inp_file.map(lambda line: line.split(&#39;,&#39;)).take(10)
[[u&#39;42&#39;,
  u&#39;42&#39;,
  u&#39;55&#39;,
  u&#39;61&#39;,
  u&#39;53&#39;,
  u&#39;49&#39;,
  u&#39;43&#39;,
  u&#39;47&#39;,
  u&#39;49&#39;,
  u&#39;60&#39;,
  u&#39;68&#39;,
  u&#39;54&#39;,
  u&#39;34&#39;,
  u&#39;35&#39;,
  u&#39;35&#39;,
  u&#39;39&#39;]]

&gt;&gt;&gt; inp_file.flatMap(lambda line: line.split(&#39;,&#39;)).take(10)
[u&#39;42&#39;, u&#39;42&#39;, u&#39;55&#39;, u&#39;61&#39;, u&#39;53&#39;, u&#39;49&#39;, u&#39;43&#39;, u&#39;47&#39;, u&#39;49&#39;, u&#39;60&#39;]
</code></pre></td></tr></table></div></div><p>从Spark获取数据还可以使用<code>collect()</code>方法，用它可以获得原始的数据形式，跟<code>parallelize()</code>作用相反，<code>parallelize()</code>解析数据把它转换成RDD，<code>collect()</code>获取执行结果。</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>&gt;&gt;&gt;</span> inp_file<span style=color:#f92672>.</span>flatMap(<span style=color:#66d9ef>lambda</span> line: line<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#39;,&#39;</span>))<span style=color:#f92672>.</span>collect()
[<span style=color:#e6db74>u</span><span style=color:#e6db74>&#39;42&#39;</span>,
 <span style=color:#e6db74>u</span><span style=color:#e6db74>&#39;42&#39;</span>,
 <span style=color:#e6db74>u</span><span style=color:#e6db74>&#39;55&#39;</span>,
 <span style=color:#e6db74>u</span><span style=color:#e6db74>&#39;61&#39;</span>,
 <span style=color:#e6db74>u</span><span style=color:#e6db74>&#39;53&#39;</span>,
 <span style=color:#e6db74>u</span><span style=color:#e6db74>&#39;49&#39;</span>,
 <span style=color:#e6db74>u</span><span style=color:#e6db74>&#39;43&#39;</span>,
 <span style=color:#e6db74>u</span><span style=color:#e6db74>&#39;47&#39;</span>,
 <span style=color:#e6db74>u</span><span style=color:#e6db74>&#39;49&#39;</span>,
 <span style=color:#e6db74>u</span><span style=color:#e6db74>&#39;60&#39;</span>,
 <span style=color:#e6db74>u</span><span style=color:#e6db74>&#39;68&#39;</span>,
 <span style=color:#e6db74>u</span><span style=color:#e6db74>&#39;54&#39;</span>,
 <span style=color:#e6db74>u</span><span style=color:#e6db74>&#39;34&#39;</span>,
 <span style=color:#e6db74>u</span><span style=color:#e6db74>&#39;35&#39;</span>,
 <span style=color:#e6db74>u</span><span style=color:#e6db74>&#39;35&#39;</span>,
 <span style=color:#e6db74>u</span><span style=color:#e6db74>&#39;39&#39;</span>]
</code></pre></td></tr></table></div></div><h3 id=保存rdd数据>保存RDD数据</h3><p>使用<code>saveAsTextFile</code>方法可以保存RDD数据</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>&gt;&gt;&gt;</span> <span style=color:#960050;background-color:#1e0010>!</span>cat data<span style=color:#f92672>/</span>Line_of_numbers<span style=color:#f92672>.</span>csv
<span style=color:#ae81ff>42</span>,<span style=color:#ae81ff>42</span>,<span style=color:#ae81ff>55</span>,<span style=color:#ae81ff>61</span>,<span style=color:#ae81ff>53</span>,<span style=color:#ae81ff>49</span>,<span style=color:#ae81ff>43</span>,<span style=color:#ae81ff>47</span>,<span style=color:#ae81ff>49</span>,<span style=color:#ae81ff>60</span>,<span style=color:#ae81ff>68</span>,<span style=color:#ae81ff>54</span>,<span style=color:#ae81ff>34</span>,<span style=color:#ae81ff>35</span>,<span style=color:#ae81ff>35</span>,<span style=color:#ae81ff>39</span>

<span style=color:#f92672>&gt;&gt;&gt;</span> inp_file <span style=color:#f92672>=</span> sc<span style=color:#f92672>.</span>textFile(<span style=color:#e6db74>&#34;data/Line_of_numbers.csv&#34;</span>)

<span style=color:#f92672>&gt;&gt;&gt;</span> inp_file<span style=color:#f92672>.</span>saveAsTextFile(<span style=color:#e6db74>&#34;out.txt&#34;</span>)

<span style=color:#f92672>&gt;&gt;&gt;</span> <span style=color:#960050;background-color:#1e0010>!</span>file out<span style=color:#f92672>.</span>txt<span style=color:#f92672>/*</span>
out<span style=color:#f92672>.</span>txt<span style=color:#f92672>/</span>_SUCCESS:   empty
out<span style=color:#f92672>.</span>txt<span style=color:#f92672>/</span>part<span style=color:#f92672>-</span><span style=color:#ae81ff>00000</span>: ASCII text
out<span style=color:#f92672>.</span>txt<span style=color:#f92672>/</span>part<span style=color:#f92672>-</span><span style=color:#ae81ff>00001</span>: empty
</code></pre></td></tr></table></div></div><p>可以看到是以目录的形式保存的数据</p><p>读取保存的数据</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>&gt;&gt;&gt;</span> read_file <span style=color:#f92672>=</span> sc<span style=color:#f92672>.</span>textFile(<span style=color:#e6db74>&#34;out.txt&#34;</span>)

<span style=color:#f92672>&gt;&gt;&gt;</span> read_file<span style=color:#f92672>.</span>take(<span style=color:#ae81ff>10</span>)
[<span style=color:#e6db74>u</span><span style=color:#e6db74>&#39;42,42,55,61,53,49,43,47,49,60,68,54,34,35,35,39&#39;</span>]
</code></pre></td></tr></table></div></div><h2 id=spark20-概念>Spark2.0 概念</h2><p>下图是一个数据掮客的架构:</p><p><img src=https://cdn.jsdelivr.net/gh/crazygit/static@main/img/2018-01-14-StackArchitecture.png alt="Stack Architecture"></p><ul><li>Data Hub</li><li>Analytics Hub</li><li>Reporting Hub</li><li>Visualization</li><li>ETL</li></ul><h3 id=data-hub>Data Hub</h3><p>数据中心 存储所有数据，数据来自于ETL服务，Kafaka等。数据可以是多种主题: 如市场数据，交易数据，文本日志，社交数据，非结构化的数据。也可以是一些跟时间序列相关的数据。</p><h3 id=reporting-hub>Reporting Hub</h3><p>报告中心 通常包含结构化和聚合之后的数据，用于日常报表和可视化面板。spark在这里主要做ETL和变形。数据可视化工具,比如:</p><ul><li>Tableau</li><li>Quilk</li><li>Pentaho</li></ul><p>可以直接通过SparkSQL读取Spark里的数据。</p><h3 id=analytics-hub>Analytics Hub</h3><p>分析中心 是数据分析师花费大部分时间的地方。分析中心可以从数据中心获取大量数据，
然后生成intermediate Datasets，特征提取，model Datasets。</p><p>DataFrames, MLlib, GraphX, and ML pipelines 也在这里生成。</p><h3 id=spark-full-stack>Spark Full Stack</h3><p><img src=https://cdn.jsdelivr.net/gh/crazygit/static@main/img/2018-01-15-SparkFullStack.png alt="Spark Full Stack"></p><h3 id=大数据存储parquethttpsparquetapacheorg><a href=https://parquet.apache.org/>大数据存储Parquet</a></h3><h2 id=spark-sql>Spark SQL</h2><p><img src=https://cdn.jsdelivr.net/gh/crazygit/static@main/img/2018-01-15-SparkSQLArchitecture.png alt="Spark SQL Architeture"></p><p>下面的例子使用的数据文件下载地址:</p><p><a href=https://github.com/xsankar/fdps-v3>https://github.com/xsankar/fdps-v3</a></p><h3 id=单表查询>单表查询</h3><p>读取csv文件, 返回的<code>employees</code>是一个<code>pyspark.sql.dataframe.DataFrame</code>类型</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>&gt;&gt;&gt;</span> print(<span style=color:#e6db74>&#39;Running Spark version: </span><span style=color:#e6db74>%s</span><span style=color:#e6db74>&#39;</span> <span style=color:#f92672>%</span> spark<span style=color:#f92672>.</span>version)
Running Spark version: <span style=color:#ae81ff>2.2.1</span>

<span style=color:#f92672>&gt;&gt;&gt;</span> employees <span style=color:#f92672>=</span> spark<span style=color:#f92672>.</span>read<span style=color:#f92672>.</span>option(<span style=color:#e6db74>&#39;header&#39;</span>, <span style=color:#e6db74>&#39;true&#39;</span>)<span style=color:#f92672>.</span>csv(<span style=color:#e6db74>&#39;data/NW-Employees.csv&#39;</span>)
</code></pre></td></tr></table></div></div><p>统计总行数</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>&gt;&gt;&gt;</span> print(<span style=color:#e6db74>&#39;Employees has </span><span style=color:#e6db74>%d</span><span style=color:#e6db74> rows&#39;</span> <span style=color:#f92672>%</span> employees<span style=color:#f92672>.</span>count())
Employees has <span style=color:#ae81ff>9</span> rows
</code></pre></td></tr></table></div></div><p>打印前5行</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>&gt;&gt;&gt;</span> employees<span style=color:#f92672>.</span>show(<span style=color:#ae81ff>5</span>)
<span style=color:#f92672>+----------+---------+---------+--------------------+---------+--------+--------+-----+-------+-------+---------+</span>
<span style=color:#f92672>|</span>EmployeeID<span style=color:#f92672>|</span> LastName<span style=color:#f92672>|</span>FirstName<span style=color:#f92672>|</span>               Title<span style=color:#f92672>|</span>BirthDate<span style=color:#f92672>|</span>HireDate<span style=color:#f92672>|</span>    City<span style=color:#f92672>|</span>State<span style=color:#f92672>|</span>    Zip<span style=color:#f92672>|</span>Country<span style=color:#f92672>|</span>ReportsTo<span style=color:#f92672>|</span>
<span style=color:#f92672>+----------+---------+---------+--------------------+---------+--------+--------+-----+-------+-------+---------+</span>
<span style=color:#f92672>|</span>         <span style=color:#ae81ff>1</span><span style=color:#f92672>|</span>   Fuller<span style=color:#f92672>|</span>   Andrew<span style=color:#f92672>|</span>Sales Representative<span style=color:#f92672>|</span>  <span style=color:#ae81ff>12</span><span style=color:#f92672>/</span><span style=color:#ae81ff>6</span><span style=color:#f92672>/</span><span style=color:#ae81ff>48</span><span style=color:#f92672>|</span> <span style=color:#ae81ff>4</span><span style=color:#f92672>/</span><span style=color:#ae81ff>29</span><span style=color:#f92672>/</span><span style=color:#ae81ff>92</span><span style=color:#f92672>|</span> Seattle<span style=color:#f92672>|</span>   WA<span style=color:#f92672>|</span>  <span style=color:#ae81ff>98122</span><span style=color:#f92672>|</span>    USA<span style=color:#f92672>|</span>        <span style=color:#ae81ff>2</span><span style=color:#f92672>|</span>
<span style=color:#f92672>|</span>         <span style=color:#ae81ff>2</span><span style=color:#f92672>|</span>  Davolio<span style=color:#f92672>|</span>    Nancy<span style=color:#f92672>|</span>Vice President, S<span style=color:#f92672>...|</span>  <span style=color:#ae81ff>2</span><span style=color:#f92672>/</span><span style=color:#ae81ff>17</span><span style=color:#f92672>/</span><span style=color:#ae81ff>52</span><span style=color:#f92672>|</span> <span style=color:#ae81ff>8</span><span style=color:#f92672>/</span><span style=color:#ae81ff>12</span><span style=color:#f92672>/</span><span style=color:#ae81ff>92</span><span style=color:#f92672>|</span>  Tacoma<span style=color:#f92672>|</span>   WA<span style=color:#f92672>|</span>  <span style=color:#ae81ff>98401</span><span style=color:#f92672>|</span>    USA<span style=color:#f92672>|</span>        <span style=color:#ae81ff>0</span><span style=color:#f92672>|</span>
<span style=color:#f92672>|</span>         <span style=color:#ae81ff>3</span><span style=color:#f92672>|</span>Leverling<span style=color:#f92672>|</span>    Janet<span style=color:#f92672>|</span>Sales Representative<span style=color:#f92672>|</span>  <span style=color:#ae81ff>8</span><span style=color:#f92672>/</span><span style=color:#ae81ff>28</span><span style=color:#f92672>/</span><span style=color:#ae81ff>63</span><span style=color:#f92672>|</span> <span style=color:#ae81ff>3</span><span style=color:#f92672>/</span><span style=color:#ae81ff>30</span><span style=color:#f92672>/</span><span style=color:#ae81ff>92</span><span style=color:#f92672>|</span>Kirkland<span style=color:#f92672>|</span>   WA<span style=color:#f92672>|</span>  <span style=color:#ae81ff>98033</span><span style=color:#f92672>|</span>    USA<span style=color:#f92672>|</span>        <span style=color:#ae81ff>2</span><span style=color:#f92672>|</span>
<span style=color:#f92672>|</span>         <span style=color:#ae81ff>4</span><span style=color:#f92672>|</span>  Peacock<span style=color:#f92672>|</span> Margaret<span style=color:#f92672>|</span>Sales Representative<span style=color:#f92672>|</span>  <span style=color:#ae81ff>9</span><span style=color:#f92672>/</span><span style=color:#ae81ff>17</span><span style=color:#f92672>/</span><span style=color:#ae81ff>37</span><span style=color:#f92672>|</span>  <span style=color:#ae81ff>5</span><span style=color:#f92672>/</span><span style=color:#ae81ff>1</span><span style=color:#f92672>/</span><span style=color:#ae81ff>93</span><span style=color:#f92672>|</span> Redmond<span style=color:#f92672>|</span>   WA<span style=color:#f92672>|</span>  <span style=color:#ae81ff>98052</span><span style=color:#f92672>|</span>    USA<span style=color:#f92672>|</span>        <span style=color:#ae81ff>2</span><span style=color:#f92672>|</span>
<span style=color:#f92672>|</span>         <span style=color:#ae81ff>5</span><span style=color:#f92672>|</span>Dodsworth<span style=color:#f92672>|</span>     Anne<span style=color:#f92672>|</span>       Sales Manager<span style=color:#f92672>|</span>   <span style=color:#ae81ff>3</span><span style=color:#f92672>/</span><span style=color:#ae81ff>2</span><span style=color:#f92672>/</span><span style=color:#ae81ff>55</span><span style=color:#f92672>|</span><span style=color:#ae81ff>10</span><span style=color:#f92672>/</span><span style=color:#ae81ff>15</span><span style=color:#f92672>/</span><span style=color:#ae81ff>93</span><span style=color:#f92672>|</span>  London<span style=color:#f92672>|</span> null<span style=color:#f92672>|</span>SW1 <span style=color:#ae81ff>8</span>JR<span style=color:#f92672>|</span>     UK<span style=color:#f92672>|</span>        <span style=color:#ae81ff>2</span><span style=color:#f92672>|</span>
<span style=color:#f92672>+----------+---------+---------+--------------------+---------+--------+--------+-----+-------+-------+---------+</span>
only showing top <span style=color:#ae81ff>5</span> rows
</code></pre></td></tr></table></div></div><p>返回前3行</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>&gt;&gt;&gt;</span> employees<span style=color:#f92672>.</span>head(<span style=color:#ae81ff>3</span>)
[Row(EmployeeID<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;1&#39;</span>, LastName<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;Fuller&#39;</span>, FirstName<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;Andrew&#39;</span>, Title<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;Sales Representative&#39;</span>, BirthDate<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;12/6/48&#39;</span>, HireDate<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;4/29/92&#39;</span>, City<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;Seattle&#39;</span>, State<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;WA&#39;</span>, Zip<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;98122&#39;</span>, Country<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;USA&#39;</span>, ReportsTo<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;2&#39;</span>),
 Row(EmployeeID<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;2&#39;</span>, LastName<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;Davolio&#39;</span>, FirstName<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;Nancy&#39;</span>, Title<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;Vice President, Sales&#39;</span>, BirthDate<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;2/17/52&#39;</span>, HireDate<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;8/12/92&#39;</span>, City<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;Tacoma&#39;</span>, State<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;WA&#39;</span>, Zip<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;98401&#39;</span>, Country<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;USA&#39;</span>, ReportsTo<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;0&#39;</span>),
 Row(EmployeeID<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;3&#39;</span>, LastName<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;Leverling&#39;</span>, FirstName<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;Janet&#39;</span>, Title<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;Sales Representative&#39;</span>, BirthDate<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;8/28/63&#39;</span>, HireDate<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;3/30/92&#39;</span>, City<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;Kirkland&#39;</span>, State<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;WA&#39;</span>, Zip<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;98033&#39;</span>, Country<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;USA&#39;</span>, ReportsTo<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;2&#39;</span>)]
</code></pre></td></tr></table></div></div><p>查看每一列的数据类型</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>&gt;&gt;&gt;</span> <span style=color:#66d9ef>for</span> column_name, data_type <span style=color:#f92672>in</span> employees<span style=color:#f92672>.</span>dtypes:
<span style=color:#f92672>...</span>     print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>{</span>column_name<span style=color:#e6db74>}</span><span style=color:#e6db74>: </span><span style=color:#e6db74>{</span>data_type<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;</span>)
<span style=color:#f92672>...</span>
EmployeeID: string
LastName: string
FirstName: string
Title: string
BirthDate: string
HireDate: string
City: string
State: string
Zip: string
Country: string
ReportsTo: string
</code></pre></td></tr></table></div></div><p>查看schema</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>&gt;&gt;&gt;</span> employees<span style=color:#f92672>.</span>printSchema()
root
 <span style=color:#f92672>|--</span> EmployeeID: string (nullable <span style=color:#f92672>=</span> true)
 <span style=color:#f92672>|--</span> LastName: string (nullable <span style=color:#f92672>=</span> true)
 <span style=color:#f92672>|--</span> FirstName: string (nullable <span style=color:#f92672>=</span> true)
 <span style=color:#f92672>|--</span> Title: string (nullable <span style=color:#f92672>=</span> true)
 <span style=color:#f92672>|--</span> BirthDate: string (nullable <span style=color:#f92672>=</span> true)
 <span style=color:#f92672>|--</span> HireDate: string (nullable <span style=color:#f92672>=</span> true)
 <span style=color:#f92672>|--</span> City: string (nullable <span style=color:#f92672>=</span> true)
 <span style=color:#f92672>|--</span> State: string (nullable <span style=color:#f92672>=</span> true)
 <span style=color:#f92672>|--</span> Zip: string (nullable <span style=color:#f92672>=</span> true)
 <span style=color:#f92672>|--</span> Country: string (nullable <span style=color:#f92672>=</span> true)
 <span style=color:#f92672>|--</span> ReportsTo: string (nullable <span style=color:#f92672>=</span> true)
</code></pre></td></tr></table></div></div><p>默认读取的数据类型都是<code>String</code>,可以设置<code>inferSchema</code>为<code>true</code>来根据数据自动推测类型。(如下: <code>EmployeeID</code>和<code>EmployeeID</code>自动推测为int)</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>&gt;&gt;&gt;</span> employees <span style=color:#f92672>=</span> spark<span style=color:#f92672>.</span>read<span style=color:#f92672>.</span>option(<span style=color:#e6db74>&#39;header&#39;</span>, <span style=color:#e6db74>&#39;true&#39;</span>)<span style=color:#f92672>.</span>option(<span style=color:#e6db74>&#39;inferSchema&#39;</span>, <span style=color:#e6db74>&#39;true&#39;</span>)<span style=color:#f92672>.</span>csv(<span style=color:#e6db74>&#39;data/NW-Employees.csv&#39;</span>)

<span style=color:#f92672>&gt;&gt;&gt;</span> <span style=color:#66d9ef>for</span> column_name, data_type <span style=color:#f92672>in</span> employees<span style=color:#f92672>.</span>dtypes:
<span style=color:#f92672>...</span>     print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>{</span>column_name<span style=color:#e6db74>}</span><span style=color:#e6db74>: </span><span style=color:#e6db74>{</span>data_type<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;</span>)
<span style=color:#f92672>...</span>
EmployeeID: int
LastName: string
FirstName: string
Title: string
BirthDate: string
HireDate: string
City: string
State: string
Zip: string
Country: string
ReportsTo: int

<span style=color:#f92672>&gt;&gt;&gt;</span> employees<span style=color:#f92672>.</span>printSchema()
root
 <span style=color:#f92672>|--</span> EmployeeID: integer (nullable <span style=color:#f92672>=</span> true)
 <span style=color:#f92672>|--</span> LastName: string (nullable <span style=color:#f92672>=</span> true)
 <span style=color:#f92672>|--</span> FirstName: string (nullable <span style=color:#f92672>=</span> true)
 <span style=color:#f92672>|--</span> Title: string (nullable <span style=color:#f92672>=</span> true)
 <span style=color:#f92672>|--</span> BirthDate: string (nullable <span style=color:#f92672>=</span> true)
 <span style=color:#f92672>|--</span> HireDate: string (nullable <span style=color:#f92672>=</span> true)
 <span style=color:#f92672>|--</span> City: string (nullable <span style=color:#f92672>=</span> true)
 <span style=color:#f92672>|--</span> State: string (nullable <span style=color:#f92672>=</span> true)
 <span style=color:#f92672>|--</span> Zip: string (nullable <span style=color:#f92672>=</span> true)
 <span style=color:#f92672>|--</span> Country: string (nullable <span style=color:#f92672>=</span> true)
 <span style=color:#f92672>|--</span> ReportsTo: integer (nullable <span style=color:#f92672>=</span> true)
</code></pre></td></tr></table></div></div><p>创建全局临时视图</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>&gt;&gt;&gt;</span> employees<span style=color:#f92672>.</span>createOrReplaceGlobalTempView(<span style=color:#e6db74>&#34;EmployeesTable&#34;</span>)
</code></pre></td></tr></table></div></div><p>查询视图(表名前面的<code>global_temp</code>不能省略，否则会报<code>Table or view not found</code>)</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>&gt;&gt;&gt;</span> result <span style=color:#f92672>=</span> spark<span style=color:#f92672>.</span>sql(<span style=color:#e6db74>&#39;select * from global_temp.EmployeesTable&#39;</span>)

<span style=color:#f92672>&gt;&gt;&gt;</span> result<span style=color:#f92672>.</span>show(<span style=color:#ae81ff>5</span>)
<span style=color:#f92672>+----------+---------+---------+--------------------+---------+--------+--------+-----+-------+-------+---------+</span>
<span style=color:#f92672>|</span>EmployeeID<span style=color:#f92672>|</span> LastName<span style=color:#f92672>|</span>FirstName<span style=color:#f92672>|</span>               Title<span style=color:#f92672>|</span>BirthDate<span style=color:#f92672>|</span>HireDate<span style=color:#f92672>|</span>    City<span style=color:#f92672>|</span>State<span style=color:#f92672>|</span>    Zip<span style=color:#f92672>|</span>Country<span style=color:#f92672>|</span>ReportsTo<span style=color:#f92672>|</span>
<span style=color:#f92672>+----------+---------+---------+--------------------+---------+--------+--------+-----+-------+-------+---------+</span>
<span style=color:#f92672>|</span>         <span style=color:#ae81ff>1</span><span style=color:#f92672>|</span>   Fuller<span style=color:#f92672>|</span>   Andrew<span style=color:#f92672>|</span>Sales Representative<span style=color:#f92672>|</span>  <span style=color:#ae81ff>12</span><span style=color:#f92672>/</span><span style=color:#ae81ff>6</span><span style=color:#f92672>/</span><span style=color:#ae81ff>48</span><span style=color:#f92672>|</span> <span style=color:#ae81ff>4</span><span style=color:#f92672>/</span><span style=color:#ae81ff>29</span><span style=color:#f92672>/</span><span style=color:#ae81ff>92</span><span style=color:#f92672>|</span> Seattle<span style=color:#f92672>|</span>   WA<span style=color:#f92672>|</span>  <span style=color:#ae81ff>98122</span><span style=color:#f92672>|</span>    USA<span style=color:#f92672>|</span>        <span style=color:#ae81ff>2</span><span style=color:#f92672>|</span>
<span style=color:#f92672>|</span>         <span style=color:#ae81ff>2</span><span style=color:#f92672>|</span>  Davolio<span style=color:#f92672>|</span>    Nancy<span style=color:#f92672>|</span>Vice President, S<span style=color:#f92672>...|</span>  <span style=color:#ae81ff>2</span><span style=color:#f92672>/</span><span style=color:#ae81ff>17</span><span style=color:#f92672>/</span><span style=color:#ae81ff>52</span><span style=color:#f92672>|</span> <span style=color:#ae81ff>8</span><span style=color:#f92672>/</span><span style=color:#ae81ff>12</span><span style=color:#f92672>/</span><span style=color:#ae81ff>92</span><span style=color:#f92672>|</span>  Tacoma<span style=color:#f92672>|</span>   WA<span style=color:#f92672>|</span>  <span style=color:#ae81ff>98401</span><span style=color:#f92672>|</span>    USA<span style=color:#f92672>|</span>        <span style=color:#ae81ff>0</span><span style=color:#f92672>|</span>
<span style=color:#f92672>|</span>         <span style=color:#ae81ff>3</span><span style=color:#f92672>|</span>Leverling<span style=color:#f92672>|</span>    Janet<span style=color:#f92672>|</span>Sales Representative<span style=color:#f92672>|</span>  <span style=color:#ae81ff>8</span><span style=color:#f92672>/</span><span style=color:#ae81ff>28</span><span style=color:#f92672>/</span><span style=color:#ae81ff>63</span><span style=color:#f92672>|</span> <span style=color:#ae81ff>3</span><span style=color:#f92672>/</span><span style=color:#ae81ff>30</span><span style=color:#f92672>/</span><span style=color:#ae81ff>92</span><span style=color:#f92672>|</span>Kirkland<span style=color:#f92672>|</span>   WA<span style=color:#f92672>|</span>  <span style=color:#ae81ff>98033</span><span style=color:#f92672>|</span>    USA<span style=color:#f92672>|</span>        <span style=color:#ae81ff>2</span><span style=color:#f92672>|</span>
<span style=color:#f92672>|</span>         <span style=color:#ae81ff>4</span><span style=color:#f92672>|</span>  Peacock<span style=color:#f92672>|</span> Margaret<span style=color:#f92672>|</span>Sales Representative<span style=color:#f92672>|</span>  <span style=color:#ae81ff>9</span><span style=color:#f92672>/</span><span style=color:#ae81ff>17</span><span style=color:#f92672>/</span><span style=color:#ae81ff>37</span><span style=color:#f92672>|</span>  <span style=color:#ae81ff>5</span><span style=color:#f92672>/</span><span style=color:#ae81ff>1</span><span style=color:#f92672>/</span><span style=color:#ae81ff>93</span><span style=color:#f92672>|</span> Redmond<span style=color:#f92672>|</span>   WA<span style=color:#f92672>|</span>  <span style=color:#ae81ff>98052</span><span style=color:#f92672>|</span>    USA<span style=color:#f92672>|</span>        <span style=color:#ae81ff>2</span><span style=color:#f92672>|</span>
<span style=color:#f92672>|</span>         <span style=color:#ae81ff>5</span><span style=color:#f92672>|</span>Dodsworth<span style=color:#f92672>|</span>     Anne<span style=color:#f92672>|</span>       Sales Manager<span style=color:#f92672>|</span>   <span style=color:#ae81ff>3</span><span style=color:#f92672>/</span><span style=color:#ae81ff>2</span><span style=color:#f92672>/</span><span style=color:#ae81ff>55</span><span style=color:#f92672>|</span><span style=color:#ae81ff>10</span><span style=color:#f92672>/</span><span style=color:#ae81ff>15</span><span style=color:#f92672>/</span><span style=color:#ae81ff>93</span><span style=color:#f92672>|</span>  London<span style=color:#f92672>|</span> null<span style=color:#f92672>|</span>SW1 <span style=color:#ae81ff>8</span>JR<span style=color:#f92672>|</span>     UK<span style=color:#f92672>|</span>        <span style=color:#ae81ff>2</span><span style=color:#f92672>|</span>
<span style=color:#f92672>+----------+---------+---------+--------------------+---------+--------+--------+-----+-------+-------+---------+</span>
only showing top <span style=color:#ae81ff>5</span> rows
</code></pre></td></tr></table></div></div><p>查看分析结果</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>&gt;&gt;&gt;</span> employees<span style=color:#f92672>.</span>explain(<span style=color:#66d9ef>True</span>)
<span style=color:#f92672>==</span> Parsed Logical Plan <span style=color:#f92672>==</span>
Relation[EmployeeID<span style=color:#75715e>#12,LastName#13,FirstName#14,Title#15,BirthDate#16,HireDate#17,City#18,State#19,Zip#20,Country#21,ReportsTo#22] csv</span>

<span style=color:#f92672>==</span> Analyzed Logical Plan <span style=color:#f92672>==</span>
EmployeeID: string, LastName: string, FirstName: string, Title: string, BirthDate: string, HireDate: string, City: string, State: string, Zip: string, Country: string, ReportsTo: string
Relation[EmployeeID<span style=color:#75715e>#12,LastName#13,FirstName#14,Title#15,BirthDate#16,HireDate#17,City#18,State#19,Zip#20,Country#21,ReportsTo#22] csv</span>

<span style=color:#f92672>==</span> Optimized Logical Plan <span style=color:#f92672>==</span>
Relation[EmployeeID<span style=color:#75715e>#12,LastName#13,FirstName#14,Title#15,BirthDate#16,HireDate#17,City#18,State#19,Zip#20,Country#21,ReportsTo#22] csv</span>

<span style=color:#f92672>==</span> Physical Plan <span style=color:#f92672>==</span>
<span style=color:#f92672>*</span>FileScan csv [EmployeeID<span style=color:#75715e>#12,LastName#13,FirstName#14,Title#15,BirthDate#16,HireDate#17,City#18,State#19,Zip#20,Country#21,ReportsTo#22] Batched: false, Format: CSV, Location: InMemoryFileIndex[file:/Users/linliang/Src/github/fdps-v3/data/NW-Employees.csv], PartitionFilters: [], PushedFilters: [], ReadSchema: struct&lt;EmployeeID:string,LastName:string,FirstName:string,Title:string,BirthDate:string,HireDate:...</span>
</code></pre></td></tr></table></div></div><p>过滤查询</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback>&gt;&gt;&gt; result = spark.sql(&#39;select * from global_temp.EmployeesTable where State=&#34;WA&#34;&#39;)

&gt;&gt;&gt; result.show(5)
+----------+---------+---------+--------------------+---------+--------+--------+-----+-----+-------+---------+
|EmployeeID| LastName|FirstName|               Title|BirthDate|HireDate|    City|State|  Zip|Country|ReportsTo|
+----------+---------+---------+--------------------+---------+--------+--------+-----+-----+-------+---------+
|         1|   Fuller|   Andrew|Sales Representative|  12/6/48| 4/29/92| Seattle|   WA|98122|    USA|        2|
|         2|  Davolio|    Nancy|Vice President, S...|  2/17/52| 8/12/92|  Tacoma|   WA|98401|    USA|        0|
|         3|Leverling|    Janet|Sales Representative|  8/28/63| 3/30/92|Kirkland|   WA|98033|    USA|        2|
|         4|  Peacock| Margaret|Sales Representative|  9/17/37|  5/1/93| Redmond|   WA|98052|    USA|        2|
|         8| Callahan|    Laura|Inside Sales Coor...|   1/7/58|  3/3/94| Seattle|   WA|98105|    USA|        2|
+----------+---------+---------+--------------------+---------+--------+--------+-----+-----+-------+---------+
</code></pre></td></tr></table></div></div><p>综合上面的所有语句到单个文件</p><p><code>single_table.py</code></p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#75715e># -*- coding: utf-8 -*-</span>

<span style=color:#f92672>from</span> pyspark.sql <span style=color:#f92672>import</span> SparkSession
<span style=color:#f92672>import</span> os

spark <span style=color:#f92672>=</span> SparkSession<span style=color:#f92672>.</span>builder<span style=color:#f92672>.</span>appName(<span style=color:#e6db74>&#39;SQL Demo&#39;</span>)<span style=color:#f92672>.</span>getOrCreate()

print(<span style=color:#e6db74>&#39;Running Spark version: </span><span style=color:#e6db74>%s</span><span style=color:#e6db74>&#39;</span> <span style=color:#f92672>%</span> spark<span style=color:#f92672>.</span>version)

filePath <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;.&#39;</span>

<span style=color:#75715e># 读取csv文件</span>
employees <span style=color:#f92672>=</span> spark<span style=color:#f92672>.</span>read<span style=color:#f92672>.</span>option(<span style=color:#e6db74>&#39;header&#39;</span>, <span style=color:#e6db74>&#39;true&#39;</span>)<span style=color:#f92672>.</span>csv(os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>join(filePath, <span style=color:#e6db74>&#39;data/NW-Employees.csv&#39;</span>))

<span style=color:#75715e># 统计总行数</span>
print(<span style=color:#e6db74>&#39;Employees has </span><span style=color:#e6db74>%d</span><span style=color:#e6db74> rows&#39;</span> <span style=color:#f92672>%</span> employees<span style=color:#f92672>.</span>count())
<span style=color:#75715e># 打印前5行</span>
employees<span style=color:#f92672>.</span>show(<span style=color:#ae81ff>5</span>)
<span style=color:#75715e># 返回前3行</span>
employees<span style=color:#f92672>.</span>head(<span style=color:#ae81ff>3</span>)


<span style=color:#75715e># 查看每一列的数据类型，默认读取的数据都是String</span>
<span style=color:#66d9ef>for</span> column_name, data_type <span style=color:#f92672>in</span> employees<span style=color:#f92672>.</span>dtypes:
    print(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>{</span>column_name<span style=color:#e6db74>}</span><span style=color:#e6db74>: </span><span style=color:#e6db74>{</span>data_type<span style=color:#e6db74>}</span><span style=color:#e6db74>&#39;</span>)

employees<span style=color:#f92672>.</span>printSchema()

<span style=color:#75715e># 创建全局的临时视图</span>
employees<span style=color:#f92672>.</span>createOrReplaceGlobalTempView(<span style=color:#e6db74>&#34;EmployeesTable&#34;</span>)
<span style=color:#75715e># 查询视图</span>
result <span style=color:#f92672>=</span> spark<span style=color:#f92672>.</span>sql(<span style=color:#e6db74>&#39;select * from global_temp.EmployeesTable&#39;</span>)
result<span style=color:#f92672>.</span>show(<span style=color:#ae81ff>5</span>)

<span style=color:#75715e># 查看分析结果</span>
employees<span style=color:#f92672>.</span>explain(<span style=color:#66d9ef>True</span>)

<span style=color:#75715e># 添加过滤条件</span>
result <span style=color:#f92672>=</span> spark<span style=color:#f92672>.</span>sql(<span style=color:#e6db74>&#39;select * from global_temp.EmployeesTable where State=&#34;WA&#34;&#39;</span>)
result<span style=color:#f92672>.</span>show(<span style=color:#ae81ff>5</span>)

spark<span style=color:#f92672>.</span>stop()
</code></pre></td></tr></table></div></div><h3 id=多表查询>多表查询</h3><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">48
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">49
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">50
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">51
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">52
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">53
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">54
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">55
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">56
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">57
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">58
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">59
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">60
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">61
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">62
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">63
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">64
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">65
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">66
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">67
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">68
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">69
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">70
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">71
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">72
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">73
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">74
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">75
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">76
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>&gt;&gt;&gt;</span> orders <span style=color:#f92672>=</span> spark<span style=color:#f92672>.</span>read<span style=color:#f92672>.</span>option(<span style=color:#e6db74>&#39;header&#39;</span>, <span style=color:#e6db74>&#39;true&#39;</span>)<span style=color:#f92672>.</span>option(<span style=color:#e6db74>&#34;inferSchema&#34;</span>, <span style=color:#e6db74>&#34;true&#34;</span>)<span style=color:#f92672>.</span>csv(<span style=color:#e6db74>&#39;data/NW-Orders.csv&#39;</span>)

<span style=color:#f92672>&gt;&gt;&gt;</span> order_details <span style=color:#f92672>=</span> spark<span style=color:#f92672>.</span>read<span style=color:#f92672>.</span>option(<span style=color:#e6db74>&#39;header&#39;</span>, <span style=color:#e6db74>&#39;true&#39;</span>)<span style=color:#f92672>.</span>option(<span style=color:#e6db74>&#34;inferSchema&#34;</span>, <span style=color:#e6db74>&#34;true&#34;</span>)<span style=color:#f92672>.</span>csv(<span style=color:#e6db74>&#39;data/NW-Order-Details.csv&#39;</span>)

<span style=color:#f92672>&gt;&gt;&gt;</span> orders<span style=color:#f92672>.</span>createOrReplaceTempView(<span style=color:#e6db74>&#34;OrdersTable&#34;</span>)

<span style=color:#f92672>&gt;&gt;&gt;</span> order_details<span style=color:#f92672>.</span>createOrReplaceTempView(<span style=color:#e6db74>&#34;OrderDetailsTable&#34;</span>)

<span style=color:#f92672>&gt;&gt;&gt;</span> result <span style=color:#f92672>=</span> spark<span style=color:#f92672>.</span>sql(<span style=color:#e6db74>&#39;&#39;&#39;
</span><span style=color:#e6db74>...    SELECT OrderDetailsTable.OrderID, ShipCountry,
</span><span style=color:#e6db74>...    UnitPrice, Qty, Discount FROM OrdersTable INNER JOIN OrderDetailsTable ON
</span><span style=color:#e6db74>...    OrdersTable.OrderID = OrderDetailsTable.OrderID
</span><span style=color:#e6db74>... &#39;&#39;&#39;</span>)

<span style=color:#f92672>&gt;&gt;&gt;</span> result<span style=color:#f92672>.</span>show(<span style=color:#ae81ff>10</span>)
<span style=color:#f92672>+-------+-----------+---------+---+--------+</span>
<span style=color:#f92672>|</span>OrderID<span style=color:#f92672>|</span>ShipCountry<span style=color:#f92672>|</span>UnitPrice<span style=color:#f92672>|</span>Qty<span style=color:#f92672>|</span>Discount<span style=color:#f92672>|</span>
<span style=color:#f92672>+-------+-----------+---------+---+--------+</span>
<span style=color:#f92672>|</span>  <span style=color:#ae81ff>10248</span><span style=color:#f92672>|</span>     France<span style=color:#f92672>|</span>     <span style=color:#ae81ff>34.8</span><span style=color:#f92672>|</span>  <span style=color:#ae81ff>5</span><span style=color:#f92672>|</span>     <span style=color:#ae81ff>0.0</span><span style=color:#f92672>|</span>
<span style=color:#f92672>|</span>  <span style=color:#ae81ff>10248</span><span style=color:#f92672>|</span>     France<span style=color:#f92672>|</span>      <span style=color:#ae81ff>9.8</span><span style=color:#f92672>|</span> <span style=color:#ae81ff>10</span><span style=color:#f92672>|</span>     <span style=color:#ae81ff>0.0</span><span style=color:#f92672>|</span>
<span style=color:#f92672>|</span>  <span style=color:#ae81ff>10248</span><span style=color:#f92672>|</span>     France<span style=color:#f92672>|</span>     <span style=color:#ae81ff>14.0</span><span style=color:#f92672>|</span> <span style=color:#ae81ff>12</span><span style=color:#f92672>|</span>     <span style=color:#ae81ff>0.0</span><span style=color:#f92672>|</span>
<span style=color:#f92672>|</span>  <span style=color:#ae81ff>10249</span><span style=color:#f92672>|</span>    Germany<span style=color:#f92672>|</span>     <span style=color:#ae81ff>42.4</span><span style=color:#f92672>|</span> <span style=color:#ae81ff>40</span><span style=color:#f92672>|</span>     <span style=color:#ae81ff>0.0</span><span style=color:#f92672>|</span>
<span style=color:#f92672>|</span>  <span style=color:#ae81ff>10249</span><span style=color:#f92672>|</span>    Germany<span style=color:#f92672>|</span>     <span style=color:#ae81ff>18.6</span><span style=color:#f92672>|</span>  <span style=color:#ae81ff>9</span><span style=color:#f92672>|</span>     <span style=color:#ae81ff>0.0</span><span style=color:#f92672>|</span>
<span style=color:#f92672>|</span>  <span style=color:#ae81ff>10250</span><span style=color:#f92672>|</span>     Brazil<span style=color:#f92672>|</span>     <span style=color:#ae81ff>16.8</span><span style=color:#f92672>|</span> <span style=color:#ae81ff>15</span><span style=color:#f92672>|</span>    <span style=color:#ae81ff>0.15</span><span style=color:#f92672>|</span>
<span style=color:#f92672>|</span>  <span style=color:#ae81ff>10250</span><span style=color:#f92672>|</span>     Brazil<span style=color:#f92672>|</span>     <span style=color:#ae81ff>42.4</span><span style=color:#f92672>|</span> <span style=color:#ae81ff>35</span><span style=color:#f92672>|</span>    <span style=color:#ae81ff>0.15</span><span style=color:#f92672>|</span>
<span style=color:#f92672>|</span>  <span style=color:#ae81ff>10250</span><span style=color:#f92672>|</span>     Brazil<span style=color:#f92672>|</span>      <span style=color:#ae81ff>7.7</span><span style=color:#f92672>|</span> <span style=color:#ae81ff>10</span><span style=color:#f92672>|</span>     <span style=color:#ae81ff>0.0</span><span style=color:#f92672>|</span>
<span style=color:#f92672>|</span>  <span style=color:#ae81ff>10251</span><span style=color:#f92672>|</span>     France<span style=color:#f92672>|</span>     <span style=color:#ae81ff>16.8</span><span style=color:#f92672>|</span> <span style=color:#ae81ff>20</span><span style=color:#f92672>|</span>     <span style=color:#ae81ff>0.0</span><span style=color:#f92672>|</span>
<span style=color:#f92672>|</span>  <span style=color:#ae81ff>10251</span><span style=color:#f92672>|</span>     France<span style=color:#f92672>|</span>     <span style=color:#ae81ff>15.6</span><span style=color:#f92672>|</span> <span style=color:#ae81ff>15</span><span style=color:#f92672>|</span>    <span style=color:#ae81ff>0.05</span><span style=color:#f92672>|</span>
<span style=color:#f92672>+-------+-----------+---------+---+--------+</span>
only showing top <span style=color:#ae81ff>10</span> rows


<span style=color:#f92672>&gt;&gt;&gt;</span> result <span style=color:#f92672>=</span> spark<span style=color:#f92672>.</span>sql(<span style=color:#e6db74>&#39;&#39;&#39;
</span><span style=color:#e6db74>...   SELECT ShipCountry, SUM(OrderDetailsTable.UnitPrice *
</span><span style=color:#e6db74>...    Qty * Discount) AS ProductSales FROM OrdersTable INNER JOIN
</span><span style=color:#e6db74>...    OrderDetailsTable ON OrdersTable.OrderID = OrderDetailsTable.OrderID GROUP
</span><span style=color:#e6db74>...    BY ShipCountry
</span><span style=color:#e6db74>... &#39;&#39;&#39;</span>)

<span style=color:#f92672>&gt;&gt;&gt;</span>

<span style=color:#f92672>&gt;&gt;&gt;</span> result<span style=color:#f92672>.</span>show(<span style=color:#ae81ff>10</span>)
<span style=color:#f92672>+-----------+------------------+</span>
<span style=color:#f92672>|</span>ShipCountry<span style=color:#f92672>|</span>      ProductSales<span style=color:#f92672>|</span>
<span style=color:#f92672>+-----------+------------------+</span>
<span style=color:#f92672>|</span>     Sweden<span style=color:#f92672>|</span><span style=color:#ae81ff>5028.5599999999995</span><span style=color:#f92672>|</span>
<span style=color:#f92672>|</span>    Germany<span style=color:#f92672>|</span>        <span style=color:#ae81ff>14355.9965</span><span style=color:#f92672>|</span>
<span style=color:#f92672>|</span>     France<span style=color:#f92672>|</span> <span style=color:#ae81ff>4140.437499999999</span><span style=color:#f92672>|</span>
<span style=color:#f92672>|</span>  Argentina<span style=color:#f92672>|</span>               <span style=color:#ae81ff>0.0</span><span style=color:#f92672>|</span>
<span style=color:#f92672>|</span>    Belgium<span style=color:#f92672>|</span><span style=color:#ae81ff>1310.1250000000002</span><span style=color:#f92672>|</span>
<span style=color:#f92672>|</span>    Finland<span style=color:#f92672>|</span>          <span style=color:#ae81ff>968.3975</span><span style=color:#f92672>|</span>
<span style=color:#f92672>|</span>      Italy<span style=color:#f92672>|</span>           <span style=color:#ae81ff>934.995</span><span style=color:#f92672>|</span>
<span style=color:#f92672>|</span>     Norway<span style=color:#f92672>|</span>               <span style=color:#ae81ff>0.0</span><span style=color:#f92672>|</span>
<span style=color:#f92672>|</span>      Spain<span style=color:#f92672>|</span>           <span style=color:#ae81ff>1448.69</span><span style=color:#f92672>|</span>
<span style=color:#f92672>|</span>    Denmark<span style=color:#f92672>|</span>         <span style=color:#ae81ff>2121.2275</span><span style=color:#f92672>|</span>
<span style=color:#f92672>+-----------+------------------+</span>
only showing top <span style=color:#ae81ff>10</span> rows

<span style=color:#75715e># 排序</span>
<span style=color:#f92672>&gt;&gt;&gt;</span> result<span style=color:#f92672>.</span>orderBy(<span style=color:#e6db74>&#34;ProductSales&#34;</span>, ascending<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>)<span style=color:#f92672>.</span>show(<span style=color:#ae81ff>10</span>)
<span style=color:#f92672>+-----------+------------------+</span>
<span style=color:#f92672>|</span>ShipCountry<span style=color:#f92672>|</span>      ProductSales<span style=color:#f92672>|</span>
<span style=color:#f92672>+-----------+------------------+</span>
<span style=color:#f92672>|</span>        USA<span style=color:#f92672>|</span><span style=color:#ae81ff>17982.369499999997</span><span style=color:#f92672>|</span>
<span style=color:#f92672>|</span>    Germany<span style=color:#f92672>|</span>        <span style=color:#ae81ff>14355.9965</span><span style=color:#f92672>|</span>
<span style=color:#f92672>|</span>    Austria<span style=color:#f92672>|</span><span style=color:#ae81ff>11492.791500000001</span><span style=color:#f92672>|</span>
<span style=color:#f92672>|</span>     Brazil<span style=color:#f92672>|</span>         <span style=color:#ae81ff>8029.7585</span><span style=color:#f92672>|</span>
<span style=color:#f92672>|</span>    Ireland<span style=color:#f92672>|</span>          <span style=color:#ae81ff>7337.485</span><span style=color:#f92672>|</span>
<span style=color:#f92672>|</span>     Canada<span style=color:#f92672>|</span><span style=color:#ae81ff>5137.8099999999995</span><span style=color:#f92672>|</span>
<span style=color:#f92672>|</span>     Sweden<span style=color:#f92672>|</span><span style=color:#ae81ff>5028.5599999999995</span><span style=color:#f92672>|</span>
<span style=color:#f92672>|</span>     France<span style=color:#f92672>|</span> <span style=color:#ae81ff>4140.437499999999</span><span style=color:#f92672>|</span>
<span style=color:#f92672>|</span>  Venezuela<span style=color:#f92672>|</span>          <span style=color:#ae81ff>4004.261</span><span style=color:#f92672>|</span>
<span style=color:#f92672>|</span>    Denmark<span style=color:#f92672>|</span>         <span style=color:#ae81ff>2121.2275</span><span style=color:#f92672>|</span>
<span style=color:#f92672>+-----------+------------------+</span>
only showing top <span style=color:#ae81ff>10</span> rows

</code></pre></td></tr></table></div></div></div><div class=post-copyright><p class=copyright-item><span class=item-title>文章作者</span>
<span class=item-content>crazygit</span></p><p class=copyright-item><span class=item-title>上次更新</span>
<span class=item-content>2018-01-15</span></p><p class=copyright-item><span class=item-title>许可协议</span>
<span class=item-content><a rel="license noopener" href=https://creativecommons.org/licenses/by-nc-nd/4.0/deed.zh target=_blank>CC BY-NC-ND 4.0</a></span></p></div><div class=post-reward><input type=checkbox name=reward id=reward hidden>
<label class=reward-button for=reward>赞赏支持</label><div class=qr-code><label class=qr-code-image for=reward><img class=image src=https://cdn.jsdelivr.net/gh/crazygit/static@main/img/wechatpay.jpg>
<span>微信打赏</span></label></div></div><footer class=post-footer><div class=post-tags><a href=https://crazygit.wiseturtles.com/tags/spark/>spark</a></div><nav class=post-nav><a class=prev href=/2018/01/16/fast-data-processing-with-spark2-note-three/><i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="18" height="18"><path d="M691.908486 949.511495l75.369571-89.491197c10.963703-12.998035 10.285251-32.864502-1.499144-44.378743L479.499795 515.267417l277.93508-310.326815c11.338233-12.190647 11.035334-32.285311-.638543-44.850487l-80.46666-86.564541c-11.680017-12.583596-30.356378-12.893658-41.662889-.716314L257.233596 494.235404c-11.332093 12.183484-11.041474 32.266891.657986 44.844348l80.46666 86.564541c1.772366 1.910513 3.706415 3.533476 5.750981 4.877077l306.620399 321.703933C662.505829 963.726242 680.945807 962.528973 691.908486 949.511495z"/></svg></i><span class="prev-text nav-default">《Fast Data Processing with Spark 2（Third Edition)》读书笔记三</span>
<span class="prev-text nav-mobile">上一篇</span></a>
<a class=next href=/2018/01/11/fast-data-processing-with-spark2-note-one/><span class="next-text nav-default">《Fast Data Processing with Spark 2（Third Edition)》读书笔记一</span>
<span class="prev-text nav-mobile">下一篇</span>
<i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="18" height="18"><path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697c-11.777231-11.500939-30.216186-10.304694-41.178865 2.712784z"/></svg></i></a></nav></footer></article><div class="post bg-white"><script src=https://utteranc.es/client.js repo=crazygit/hugo-blog-comments issue-term=pathname theme=github-light crossorigin=anonymous async></script></div></div></div></main><footer id=footer class=footer><div class=icon-links><a href=mailto:crazygit@foxmail.com rel="me noopener" class=iconfont title=email><svg class="icon" viewBox="0 0 1451 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="36" height="36"><path d="M664.781909 681.472759.0 97.881301C0 3.997201 71.046997.0 71.046997.0H474.477909 961.649408h399.992405s71.046998 3.997201 71.046998 97.881301L771.345323 681.472759S764.482731 685.154773 753.594283 688.65053V688.664858C741.602731 693.493018 729.424896 695.068979 718.077952 694.839748 706.731093 695.068979 694.553173 693.493018 682.561621 688.664858V688.65053C671.644501 685.140446 664.781909 681.472759 664.781909 681.472759zm53.281707 130.131124C693.779541 811.016482 658.879232 802.205449 619.10784 767.734955 542.989056 701.759633.0 212.052267.0 212.052267V942.809523S0 1024 83.726336 1024H682.532949 753.579947h595.368192C1432.688811 1024 1432.688811 942.809523 1432.688811 942.809523V212.052267S893.138176 701.759633 817.019477 767.734955c-39.771477 34.470494-74.671786 43.295855-98.955861 43.868928z"/></svg></a><a href=https://twitter.com/lianglin999 rel="me noopener" class=iconfont title=twitter target=_blank><svg class="icon" viewBox="0 0 1264 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="36" height="36"><path d="M1229.8616 18.043658s-117.852626 63.135335-164.151872 67.344358C960.484169-78.763856 560.627046-7.210476 627.971403 308.466201 278.622548 312.675223 89.216542 47.506814 89.216542 47.506814S-28.636084 236.91282 164.978944 392.646647C127.097743 396.85567 55.544363 371.601535 55.544363 371.601535S26.081207 535.753407 253.368414 615.724832c-21.045112 29.463156-113.643603 8.418045-113.643603 8.418045s25.254134 143.10676 231.496229 180.987961c-143.10676 130.479693-387.230056 92.598492-370.393967 105.225559 206.242095 189.406006 1119.599946 231.496229 1128.01799-643.98042 50.5082679999998-16.83609 134.688715-143.10676 134.688715-143.10676s-130.479693 37.881201-138.897738 33.672179C1225.652577 98.015083 1229.8616 18.043658 1229.8616 18.043658"/></svg></a><a href=https://github.com/crazygit rel="me noopener" class=iconfont title=github target=_blank><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="36" height="36"><path d="M512 12.672c-282.88.0-512 229.248-512 512 0 226.261333 146.688 418.133333 350.08 485.76 25.6 4.821333 34.986667-11.008 34.986667-24.618667.0-12.16-.426667-44.373333-.64-87.04C242.005334 929.664 211.968 830.08 211.968 830.08 188.672 770.986667 155.008 755.2 155.008 755.2c-46.378667-31.744 3.584-31.104 3.584-31.104 51.413333 3.584 78.421333 52.736 78.421333 52.736 45.653333 78.293333 119.850667 55.68 149.12 42.581333 4.608-33.109333 17.792-55.68 32.426667-68.48-113.706667-12.8-233.216-56.832-233.216-253.013333.0-55.893333 19.84-101.546667 52.693333-137.386667-5.76-12.928-23.04-64.981333 4.48-135.509333.0.0 42.88-13.738667 140.8 52.48 40.96-11.392 84.48-17.024 128-17.28 43.52.256 87.04 5.888 128 17.28 97.28-66.218667 140.16-52.48 140.16-52.48 27.52 70.528 10.24 122.581333 5.12 135.509333 32.64 35.84 52.48 81.493333 52.48 137.386667.0 196.693333-119.68 240-233.6 252.586667 17.92 15.36 34.56 46.762667 34.56 94.72.0 68.522667-.64 123.562667-.64 140.202666.0 13.44 8.96 29.44 35.2 24.32C877.44 942.592 1024 750.592 1024 524.672c0-282.752-229.248-512-512-512"/></svg></a><a href=https://www.weibo.com/crazygit/profile rel="me noopener" class=iconfont title=weibo target=_blank><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="36" height="36"><path d="M385.714286 733.714286q12-19.428571 6.285714-39.428571t-25.714286-28.571429q-19.428571-8-41.714286-.571429t-34.285714 26.285714q-12.571429 19.428571-7.428571 39.142857t24.571429 28.857143 42.571429 1.428571 35.714286-27.142857zm53.714286-69.142857q4.571429-7.428571 2-15.142857t-10-10.571429q-8-2.857143-16.285714 2.857143t-12.285714 10.571429q-9.714286 17.714286 7.428571 25.714286 8 2.857143 16.571429 2.857143t12.571429-10.571429zm99.428571 61.142857Q513.142857 784 448.571429 811.428572t-128 6.857143q-61.142857-19.428571-84.285714-72.285714t3.714286-107.142857q26.857143-53.142857 86.571429-79.428571t120.285714-10.857143q63.428571 16.571429 90.571429 68.285714t1.428571 108.857143zm178.285714-91.428571Q712 579.428572 666.285714 537.142858t-119.142857-62.285714-156.857143-12q-127.428571 13.142857-211.142857 80.857143t-75.714286 151.142857q5.142857 54.857143 50.857143 97.142857t119.142857 62.285714 156.857143 12q127.428571-13.142857 211.142857-80.857143t75.714286-151.142857zm176 2.285714q0 38.857143-21.142857 79.714286t-62.285714 78.285714-96.285714 67.142857-129.142857 47.428571-154.571429 17.714286-157.142857-19.142857-137.428571-53.142857-98-86.285714-37.142857-114q0-65.714286 39.714286-140T152.57143 366.857144q96.571429-96.571429 195.142857-134.857143t140.857143 4q37.142857 36.571429 11.428571 119.428571-2.285714 8-.571429 11.428571t5.714286 4 8.285714 2.857143 7.714286-2l3.428571-1.142857Q604 336.857143 665.142858 336.857143t87.428571 34.857143q25.714286 36 0 101.714286-1.142857 7.428571-2.571429 11.428571T752.571429 492t6.857143 4.285714 9.714286 3.428571q32.571429 10.285714 58.857143 26.857143t45.714286 46.571429 19.428571 66.571429zM850.857143 280q24 26.857143 31.142857 62t-3.714286 67.142857q-4.571429 13.142857-16.857143 19.428571T836 430.857142q-13.142857-4.571429-19.428571-16.857143t-2.285714-25.428571q11.428571-36-13.714286-63.428571t-61.142857-20Q725.714286 308 713.714286 300.571428t-14.285714-21.142857Q696.571429 265.714285 704.000001 254t21.142857-14.571429q34.285714-7.428571 68 3.142857t57.714286 37.428571zm103.428571-93.142857Q1004 241.714286 1018.571428 314t-7.714286 138q-5.142857 15.428571-19.428571 22.857143t-29.714286 2.285714-22.857143-19.428571T935.999999 428q16-46.857143 5.714286-98.285714t-45.714286-90.285714q-35.428571-39.428571-84.571429-54.571429T712.571427 180q-16 3.428571-29.714286-5.428571t-17.142857-24.857143 5.428571-29.428571 24.857143-16.857143q70.285714-14.857143 139.428571 6.571429t118.857143 76.857143z"/></svg></a><a href=https://crazygit.wiseturtles.com/index.xml rel="noopener alternate" type=application/rss+xml class=iconfont title=rss target=_blank><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="30" height="30"><path d="M819.157333 1024C819.157333 574.592 449.408 204.8.0 204.8V0c561.706667.0 1024 462.293333 1024 1024H819.157333zM140.416 743.04a140.8 140.8.0 01140.501333 140.586667A140.928 140.928.0 01140.074667 1024C62.72 1024 0 961.109333.0 883.626667S62.933333 743.082667 140.416 743.04zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667v-199.04c372.352.0 678.784 306.517333 678.784 678.826667z"/></svg></a></div><div class=copyright><span class=power-by>Powered by <a class=hexo-link href=https://gohugo.io>Hugo</a></span>
<span class=division>|</span>
<span class=theme-info>Theme - <a class=theme-link href=https://github.com/xianmin/hugo-theme-jane>Jane</a></span>
<span class=copyright-year>&copy;
2017 -
2021
<span class=heart><i class=iconfont><svg class="icon" viewBox="0 0 1025 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="14" height="14"><path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7.0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1.0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2.0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3.1-42.5-8-83.6-24-122.2z" fill="#8a8a8a"/></svg></i></span><span class=author>crazygit</span></span>
<span id=busuanzi_container>访客数/访问量：<span id=busuanzi_value_site_uv></span>/<span id=busuanzi_value_site_pv></span></span></div></footer><div class=back-to-top id=back-to-top><i class=iconfont><svg class="icon" viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="35" height="35"><path d="M510.866688 227.694839 95.449397 629.218702h235.761562L329.15309 958.01517h362.40389L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777h894.052392v131.813095H63.840492V63.962777zm0 0"/></svg></i></div></div><script type=text/javascript src=/lib/jquery/jquery-3.2.1.min.js></script><script type=text/javascript src=/lib/slideout/slideout-1.0.1.min.js></script><script type=text/javascript src=/js/main.638251f4230630f0335d8c6748e53a96f94b72670920b60c09a56fdc8bece214.js integrity="sha256-Y4JR9CMGMPAzXYxnSOU6lvlLcmcJILYMCaVv3Ivs4hQ=" crossorigin=anonymous></script><script id=baidu_analytics>var _hmt=_hmt||[];(function(){var a,b;if(window.location.hostname==='localhost')return;a=document.createElement("script"),a.async=!0,a.src="https://hm.baidu.com/hm.js?2b47f91b8532d1a5e950c8e77142d95c",b=document.getElementsByTagName("script")[0],b.parentNode.insertBefore(a,b)})()</script><script id=baidu_push>(function(){var a,c,b;if(window.location.hostname==='localhost')return;a=document.createElement('script'),a.async=!0,c=window.location.protocol.split(':')[0],c==='https'?a.src='https://zz.bdstatic.com/linksubmit/push.js':a.src='http://push.zhanzhang.baidu.com/push.js',b=document.getElementsByTagName("script")[0],b.parentNode.insertBefore(a,b)})()</script><script type=text/javascript src=/js/load-photoswipe.js></script><script type=text/javascript src=/lib/photoswipe/photoswipe.min.js></script><script type=text/javascript src=/lib/photoswipe/photoswipe-ui-default.min.js></script><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><script src=https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js></script><script type=text/javascript>AV.initialize("bWUs89CHYswTxwt88Jf71tIF-gzGzoHsz","IcudhQhVD2eqKqkOTQQ6agUS")</script><script>function showHitCount(d){var b=new AV.Query(d),a=[],c=$(".leancloud_visitors");c.each(function(){a.push($(this).attr("id").trim())}),b.containedIn('url',a),b.find().done(function(d){var e='.leancloud-visitors-count',b,h,f,j,g,i;if(d.length===0){c.find(e).text(0);return}for(b=0;b<d.length;b++)h=d[b],f=h.get('url'),j=h.get('hits'),g=document.getElementById(f),$(g).find(e).text(j);for(b=0;b<a.length;b++)f=a[b],g=document.getElementById(f),i=$(g).find(e),i.text()==''&&i.text(0)}).fail(function(b,a){console.log("Error: "+a.code+" "+a.message)})}function addCount(b){var c=$(".leancloud_visitors"),a=c.attr('id').trim(),e=c.attr('data-flag-title').trim(),d=new AV.Query(b);d.equalTo("url",a),d.find({success:function(g){var d,c,f;g.length>0?(d=g[0],d.fetchWhenSave(!0),d.increment("hits"),d.save(null,{success:function(b){var c=$(document.getElementById(a));c.find('.leancloud-visitors-count').text(b.get('hits'))},error:function(b,a){console.log('Failed to save Visitor num, with error message: '+a.message)}})):(c=new b,f=new AV.ACL,f.setPublicReadAccess(!0),f.setPublicWriteAccess(!0),c.setACL(f),c.set("title",e),c.set("url",a),c.set("hits",1),c.save(null,{success:function(b){var c=$(document.getElementById(a));c.find('.leancloud-visitors-count').text(b.get('hits'))},error:function(a,b){console.log('Failed to create')}}))},error:function(a){console.log('Error:'+a.code+" "+a.message)}})}$(function(){var a=AV.Object.extend("Counter");$('.leancloud_visitors').length==1?addCount(a):$('.post-link').length>1&&showHitCount(a)})</script></body></html>