<!DOCTYPE html>
<html lang="zh-cn" itemscope itemtype="http://schema.org/WebPage">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>《A Programmer&#39;s Guide to Data Mining》读书笔记一 - Soul Mate</title>
  

<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta name="MobileOptimized" content="width"/>
<meta name="HandheldFriendly" content="true"/>


<meta name="applicable-device" content="pc,mobile">
<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="mobile-web-app-capable" content="yes">

<meta name="author" content="crazygit" /><meta name="description" content="推荐系统入门， 物品相似度计算方法汇总
" />

  <meta name="keywords" content="Hugo, crazygit, blog" />


<meta name="baidu-site-verification" content="mEI3NT6pyx" />
<meta name="google-site-verification" content="AbF6G10N67H-FaerplTnvfAXJrTtXBGHdr4xsSot7z8" />


<meta name="generator" content="Hugo 0.49.2" />


<link rel="canonical" href="https://crazygit.wiseturtles.com/2018/01/22/a-programmers-guid-to-data-mining-note-one/" />



<link rel="icon" href="/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">







<link href="/dist/jane.min.css?v=2.7.0" rel="stylesheet">



<link rel="stylesheet" href="/css/douban.css">

<link rel="stylesheet" href="/css/monokai-syntax.css">


<meta property="og:title" content="《A Programmer&#39;s Guide to Data Mining》读书笔记一" />
<meta property="og:description" content="推荐系统入门， 物品相似度计算方法汇总
" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://crazygit.wiseturtles.com/2018/01/22/a-programmers-guid-to-data-mining-note-one/" /><meta property="article:published_time" content="2018-01-22T17:34:52&#43;08:00"/>
<meta property="article:modified_time" content="2018-01-22T17:34:52&#43;08:00"/>

<meta itemprop="name" content="《A Programmer&#39;s Guide to Data Mining》读书笔记一">
<meta itemprop="description" content="推荐系统入门， 物品相似度计算方法汇总
">


<meta itemprop="datePublished" content="2018-01-22T17:34:52&#43;08:00" />
<meta itemprop="dateModified" content="2018-01-22T17:34:52&#43;08:00" />
<meta itemprop="wordCount" content="3220">



<meta itemprop="keywords" content="推荐系统,相似度计算," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="《A Programmer&#39;s Guide to Data Mining》读书笔记一"/>
<meta name="twitter:description" content="推荐系统入门， 物品相似度计算方法汇总
"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-112251188-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>



</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Soul Mate</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://crazygit.wiseturtles.com/">主页</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://crazygit.wiseturtles.com/categories/">分类</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://crazygit.wiseturtles.com/post/">归档</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://crazygit.wiseturtles.com/tags/">标签</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://crazygit.wiseturtles.com/books/">读书</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://crazygit.wiseturtles.com/about/">关于</a>
          
        
      </li>
    
  </ul>
</nav>


  
    






  <link rel="stylesheet" href="/lib/photoswipe/photoswipe.min.css" />
  <link rel="stylesheet" href="/lib/photoswipe/default-skin/default-skin.min.css" />




<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

  

  

  <header id="header" class="header container">
    <div class="logo-wrapper">
  <a href="/" class="logo">
    
      Soul Mate
    
  </a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    
      <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://crazygit.wiseturtles.com/">主页</a>
          

        

      </li>
    
      <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://crazygit.wiseturtles.com/categories/">分类</a>
          

        

      </li>
    
      <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://crazygit.wiseturtles.com/post/">归档</a>
          

        

      </li>
    
      <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://crazygit.wiseturtles.com/tags/">标签</a>
          

        

      </li>
    
      <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://crazygit.wiseturtles.com/books/">读书</a>
          

        

      </li>
    
      <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://crazygit.wiseturtles.com/about/">关于</a>
          

        

      </li>
    
    
  </ul>
</nav>

  </header>

  <div id="mobile-panel">
    <main id="main" class="main bg-llight">
      <div class="content-wrapper">
        <div id="content" class="content container">
          <article class="post bg-white">
    
    <header class="post-header">
      <h1 class="post-title">《A Programmer&#39;s Guide to Data Mining》读书笔记一</h1>
      
      <div class="post-meta">
        <span class="post-time"> 2018-01-22 </span>
        <div class="post-category">
            <a href="https://crazygit.wiseturtles.com/categories/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/"> 推荐系统 </a>
            
          </div>
        <span class="more-meta"> 约 3220 字 </span>
          <span class="more-meta"> 预计阅读 7 分钟 </span>

        
        

        
        
          <span id="/2018/01/22/a-programmers-guid-to-data-mining-note-one/" class="leancloud_visitors" data-flag-title="《A Programmer&#39;s Guide to Data Mining》读书笔记一">
            <span class="post-meta-item-text"> | 阅读 </span>
            <span class="leancloud-visitors-count"></span>
          </span>
        
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#如何找到相似的用户">如何找到相似的用户</a>
<ul>
<li><a href="#曼哈顿距离-manhattan-distance">曼哈顿距离(Manhattan Distance)</a></li>
<li><a href="#欧几里得距离-euclidean-distance">欧几里得距离(Euclidean Distance)</a></li>
<li><a href="#切比雪夫距离-chebyshev-distance">切比雪夫距离(Chebyshev Distance)</a></li>
<li><a href="#闵可夫斯基距离-minkowski-distance">闵可夫斯基距离(Minkowski Distance)</a></li>
<li><a href="#皮尔逊相关系数-pearson-correlation-coefficient">皮尔逊相关系数(Pearson Correlation Coefficient)</a></li>
<li><a href="#余弦相似度-cosine-similarity">余弦相似度(Cosine Similarity)</a>
<ul>
<li><a href="#性质">性质</a></li>
</ul></li>
<li><a href="#实战">实战</a></li>
<li><a href="#相似度算法选择">相似度算法选择</a></li>
<li><a href="#距离计算库">距离计算库</a></li>
<li><a href="#k最邻近算法">K最邻近算法</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
  </div>
</div>

    
    <div class="post-content">
      <p>参考:</p>

<p><a href="http://guidetodatamining.com/">A Programmer&rsquo;s Guide to Data Mining</a></p>

<p>推荐系统中，最常用的方法就是协同过滤。顾名思义: 这个方法就是利用别人的喜好来推测你的喜好。
假如你喜欢看电影A和B， 另外一个和你<strong>相似的用户</strong>也喜欢电影A和B，同时他还喜欢看电影C，那么我们就会推测你也喜欢电影C。</p>

<p><a href="https://en.wikipedia.org/?title=Collaborative_filtering">如图所示</a></p>

<p><img src="http://images.wiseturtles.com/2018-01-19-Collaborative_filtering.gif" alt="" /></p>

<p></p>

<h2 id="如何找到相似的用户">如何找到相似的用户</h2>

<p>相似度计算方法有很多，本文将主要介绍以下几种</p>

<p>距离算法</p>

<ul>
<li>曼哈顿距离(Manhattan Distance)</li>
<li>欧几里得距离(Euclidean Distance)</li>
<li>切比雪夫距离(Chebyshev Distance)</li>
<li>闵可夫斯基距离(Minkowski Distance)</li>
</ul>

<p>相似度系数算法</p>

<ul>
<li>皮尔逊相关系数(Pearson Correlation Coefficient)</li>
<li>向量空间余弦相似度(Cosine Similarity)</li>
</ul>

<p>对于相同的计算数据，不同的相似度计算方法结果不同，所以需要根据计算样本的特性，选择合适的计算方式。</p>

<p>更多相似度计算方法可以参考:</p>

<ul>
<li><a href="http://www.cnblogs.com/arachis/p/Similarity.html">常见的距离算法和相似度(相关系数)计算方法</a></li>
<li><a href="http://www.cnblogs.com/heaad/archive/2011/03/08/1977733.html">机器学习中的相似性度量</a></li>
<li><a href="http://blog.csdn.net/yixianfeng41/article/details/61917158">常用的相似度计算方法原理及实现</a></li>
</ul>

<h3 id="曼哈顿距离-manhattan-distance">曼哈顿距离(Manhattan Distance)</h3>

<p>参考<a href="https://baike.baidu.com/item/%E6%9B%BC%E5%93%88%E9%A1%BF%E8%B7%9D%E7%A6%BB">百度百科</a></p>

<blockquote>
<p>曼哈顿距离，又叫出租车距离（Manhattan Distance）是由十九世纪的赫尔曼·闵可夫斯基所创词汇 ，是种使用在几何度量空间的几何学用语，用以标明两个点在标准坐标系上的绝对轴距总和。</p>
</blockquote>

<p><img src="http://images.wiseturtles.com/2018-01-22-manhattan.jpg" alt="" /></p>

<blockquote>
<p>图中红线代表曼哈顿距离，绿色代表欧氏距离，也就是直线距离，而蓝色和黄色代表等价的曼哈顿距离。曼哈顿距离——两点在南北方向上的距离加上在东西方向上的距离，即$d(i, j）= |x_i - x_j|+|y_i - y_j|$。对于一个具有正南正北、正东正西方向规则布局的城镇街道，从一点到达另一点的距离正是在南北方向上旅行的距离加上在东西方向上旅行的距离，因此，曼哈顿距离又称为出租车距离。曼哈顿距离不是距离不变量，当坐标轴变动时，点间的距离就会不同。曼哈顿距离示意图在早期的计算机图形学中，屏幕是由像素构成，是整数，点的坐标也一般是整数，原因是浮点运算很昂贵，很慢而且有误差，如果直接使用AB的欧氏距离(欧几里德距离: 在二维和三维空间中的欧氏距离的就是两点之间的距离），则必须要进行浮点运算，如果使用AC和CB，则只要计算加减法即可，这就大大提高了运算速度，而且不管累计运算多少次，都不会有误差。</p>
</blockquote>

<ul>
<li>二维平面两点a(x1,y1)与b(x2,y2)间的曼哈顿距离</li>
</ul>

<p>$$
d_{ab} = |x_1 - x_2| + |y_1 - y_2|
$$</p>

<ul>
<li>两个n维向量a(x11,x12,…,x1n)与b(x21,x22,…,x2n)间的曼哈顿距离</li>
</ul>

<p>{% math %}</p>

<p>d<em>{ab} =\sum\limits</em>{k=1}^n|x<em>{1k} - x</em>{2k}|</p>

<p>{% endmath %}</p>

<h3 id="欧几里得距离-euclidean-distance">欧几里得距离(Euclidean Distance)</h3>

<p>参考<a href="在数学中，欧几里得距离或欧几里得度量是欧几里得空间中两点间“普通”（即直线）距离">维基百科</a></p>

<blockquote>
<p>在数学中，欧几里得距离或欧几里得度量是欧几里得空间中两点间“普通”（即直线）距离</p>
</blockquote>

<ul>
<li>二维平面上两点a(x1,y1)与b(x2,y2)间的欧几里得距离:</li>
</ul>

<p>$$
d_{ab} = \sqrt{(x_1-x_2)^2 + (y_1-y_2)^2}
$$</p>

<ul>
<li>两个n维向量a(x11,x12,…,x1n)与 b(x21,x22,…,x2n)间的欧几里得距离</li>
</ul>

<p>{% math %}</p>

<p>d<em>{ab} = \sqrt{\sum\limits</em>{k=1}^n(x<em>{1k} - x</em>{2k})^2}</p>

<p>{% endmath %}</p>

<h3 id="切比雪夫距离-chebyshev-distance">切比雪夫距离(Chebyshev Distance)</h3>

<p>参考<a href="https://zh.wikipedia.org/wiki/%E5%88%87%E6%AF%94%E9%9B%AA%E5%A4%AB%E8%B7%9D%E7%A6%BB">维基百科</a></p>

<blockquote>
<p>数学上，切比雪夫距离（Chebyshev distance）或是L∞度量是向量空间中的一种度量，二个点之间的距离定义为_其各座标数值差的最大值_。以(x1,y1)和(x2,y2)二点为例，其切比雪夫距离为max(|x2-x1|,|y2-y1|)。切比雪夫距离得名自俄罗斯数学家切比雪夫。</p>
</blockquote>

<p><img src="http://images.wiseturtles.com/2018-01-22-Chebyshev.png" alt="" /></p>

<blockquote>
<p>若将国际象棋棋盘放在二维直角座标系中，格子的边长定义为1，座标的x轴及y轴和棋盘方格平行，原点恰落在某一格的中心点，则王从一个位置走到其他位置需要的步数恰为二个位置的切比雪夫距离，因此切比雪夫距离也称为棋盘距离。例如位置F6和位置E2的切比雪夫距离为4。任何一个不在棋盘边缘的位置，和周围八个位置的切比雪夫距离都是1。</p>
</blockquote>

<ul>
<li>二维平面两点a(x1,y1)与b(x2,y2)间的切比雪夫距离</li>
</ul>

<p>$$
d_{ab} = max(|x_1-x_2|, |y_1 - y_2|)
$$</p>

<ul>
<li>两个n维向量a(x11,x12,…,x1n)与 b(x21,x22,…,x2n)间的切比雪夫距离</li>
</ul>

<p>{% math %}</p>

<p>d<em>{ab} = max(|x</em>{1i}-x_{2i}|)</p>

<p>{% endmath %}</p>

<p>等价于</p>

<p>{% math %}</p>

<p>d<em>{ab} = \lim\limits</em>{k \to \infty}(\sum\limits<em>{i=1}^{n}|x</em>{1i} - x_{2i}|^k)^{\frac{1}{k}}</p>

<p>{% endmath %}</p>

<h3 id="闵可夫斯基距离-minkowski-distance">闵可夫斯基距离(Minkowski Distance)</h3>

<p>可以将曼哈顿距离，欧几里得距离，切比雪夫距离三种距离的计算公式归纳
为一个计算公式，这就是闵可夫斯基距离(Minkowski Distance)。</p>

<p>$$
d(x, y) = (\sum\limits_{k=1}^n|x_k - y_k|^r)^{\frac{1}{r}}
$$</p>

<ul>
<li>$r = 1$, 该公式就是曼哈顿距离</li>
<li>$r = 2$, 该公式就是曼哈顿距离</li>
<li>$r = \infty$, 该公式就是切比雪夫距离</li>
</ul>

<h3 id="皮尔逊相关系数-pearson-correlation-coefficient">皮尔逊相关系数(Pearson Correlation Coefficient)</h3>

<p>参考:
<a href="https://crazygit.wiseturtles.com/2018/01/19/pearson-correlation-coefficient/">皮尔逊相关系数</a></p>

<h3 id="余弦相似度-cosine-similarity">余弦相似度(Cosine Similarity)</h3>

<p>参考<a href="https://baike.baidu.com/item/%E4%BD%99%E5%BC%A6%E7%9B%B8%E4%BC%BC%E5%BA%A6">百度百科</a></p>

<blockquote>
<p>余弦相似度，又称为余弦相似性，是通过计算两个向量的夹角余弦值来评估他们的相似度。余弦相似度将向量根据坐标值，绘制到向量空间中，如最常见的二维空间。</p>
</blockquote>

<p><img src="http://images.wiseturtles.com/2018-01-23-cosine-distance.jpg" alt="" /></p>

<ul>
<li>二维平面上，假设向量a、b的坐标分别为(x1,y1)、(x2,y2) 。则:</li>
</ul>

<p>$$
cos\theta = \frac{x_1x_2+y_1y_2}{\sqrt{x_1^2 + y_1^2}\sqrt{x_2^2 + y_2^2}}
$$</p>

<ul>
<li>推广到n维空间，计算公式为:</li>
</ul>

<p>$$
cos\theta = \frac{\sum\limits_1^n(Ai \times Bi)}{\sqrt{\sum\limits_1^nA_i^2}\sqrt{\sum\limits_1^nB_i^2}}
$$</p>

<h4 id="性质">性质</h4>

<p>余弦值的范围在[-1,1]之间，值越趋近于1，代表两个向量的方向越接近；越趋近于-1，他们的方向越相反；接近于0，表示两个向量近乎于正交。</p>

<h3 id="实战">实战</h3>

<p>在介绍了一大堆的相似度计算之后，我们来通过一些例子，说明具体的用法。
假设我们要为一个在线音乐网站的用户推荐乐队。用户可以用1-5颗星来评价他喜欢的乐队，其中包含半颗星(如2.5星)，下表展示了8位用户对8支乐队的评价:</p>

<p><img src="http://images.wiseturtles.com/2018-01-23-Recommand-Music-Bannd.png" alt="" /></p>

<p>图中的<code>-</code>表示没有评分。在计算两个用户的距离时，只考虑他们都评价过的乐队。暂时不考虑数据缺失的情况。</p>

<p>数据转换成代码如下:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">json</span>

<span class="n">users_string</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;
</span><span class="s1">{
</span><span class="s1">    &#34;Angelica&#34;: {
</span><span class="s1">        &#34;Blues Traveler&#34;: 3.5,
</span><span class="s1">        &#34;Broken Bells&#34;: 2,
</span><span class="s1">        &#34;Norah Jones&#34;: 4.5,
</span><span class="s1">        &#34;Phoenix&#34;: 5,
</span><span class="s1">        &#34;Slightly Stoopid&#34;: 1.5,
</span><span class="s1">        &#34;The Strokes&#34;: 2.5,
</span><span class="s1">        &#34;Vampire Weekend&#34;: 2
</span><span class="s1">    },
</span><span class="s1">    &#34;Bill&#34;: {
</span><span class="s1">        &#34;Blues Traveler&#34;: 2,
</span><span class="s1">        &#34;Broken Bells&#34;: 3.5,
</span><span class="s1">        &#34;Deadmau5&#34;: 4,
</span><span class="s1">        &#34;Phoenix&#34;: 2,
</span><span class="s1">        &#34;Slightly Stoopid&#34;: 3.5,
</span><span class="s1">        &#34;Vampire Weekend&#34;: 3
</span><span class="s1">    },
</span><span class="s1">    &#34;Chan&#34;: {
</span><span class="s1">        &#34;Blues Traveler&#34;: 5,
</span><span class="s1">        &#34;Broken Bells&#34;: 1,
</span><span class="s1">        &#34;Deadmau5&#34;: 1,
</span><span class="s1">        &#34;Norah Jones&#34;: 3,
</span><span class="s1">        &#34;Phoenix&#34;: 5,
</span><span class="s1">        &#34;Slightly Stoopid&#34;: 1
</span><span class="s1">    },
</span><span class="s1">    &#34;Dan&#34;: {
</span><span class="s1">        &#34;Blues Traveler&#34;: 3,
</span><span class="s1">        &#34;Broken Bells&#34;: 4,
</span><span class="s1">        &#34;Deadmau5&#34;: 4.5,
</span><span class="s1">        &#34;Phoenix&#34;: 3,
</span><span class="s1">        &#34;Slightly Stoopid&#34;: 4.5,
</span><span class="s1">        &#34;The Strokes&#34;: 4,
</span><span class="s1">        &#34;Vampire Weekend&#34;: 2
</span><span class="s1">    },
</span><span class="s1">    &#34;Hailey&#34;: {
</span><span class="s1">        &#34;Broken Bells&#34;: 4,
</span><span class="s1">        &#34;Deadmau5&#34;: 1,
</span><span class="s1">        &#34;Norah Jones&#34;: 4,
</span><span class="s1">        &#34;The Strokes&#34;: 4,
</span><span class="s1">        &#34;Vampire Weekend&#34;: 1
</span><span class="s1">    },
</span><span class="s1">    &#34;Jordyn&#34;: {
</span><span class="s1">        &#34;Broken Bells&#34;: 4.5,
</span><span class="s1">        &#34;Deadmau5&#34;: 4,
</span><span class="s1">        &#34;Norah Jones&#34;: 5,
</span><span class="s1">        &#34;Phoenix&#34;: 5,
</span><span class="s1">        &#34;Slightly Stoopid&#34;: 4.5,
</span><span class="s1">        &#34;The Strokes&#34;: 4,
</span><span class="s1">        &#34;Vampire Weekend&#34;: 4
</span><span class="s1">    },
</span><span class="s1">    &#34;Sam&#34;: {
</span><span class="s1">        &#34;Blues Traveler&#34;: 5,
</span><span class="s1">        &#34;Broken Bells&#34;: 2,
</span><span class="s1">        &#34;Norah Jones&#34;: 3,
</span><span class="s1">        &#34;Phoenix&#34;: 5,
</span><span class="s1">        &#34;Slightly Stoopid&#34;: 4,
</span><span class="s1">        &#34;The Strokes&#34;: 5
</span><span class="s1">    },
</span><span class="s1">    &#34;Veronica&#34;: {
</span><span class="s1">        &#34;Blues Traveler&#34;: 3,
</span><span class="s1">        &#34;Norah Jones&#34;: 5,
</span><span class="s1">        &#34;Phoenix&#34;: 4,
</span><span class="s1">        &#34;Slightly Stoopid&#34;: 2.5,
</span><span class="s1">        &#34;The Strokes&#34;: 3
</span><span class="s1">    }
</span><span class="s1">}
</span><span class="s1">&#39;&#39;&#39;</span>

<span class="n">users</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">users_string</span><span class="p">)</span></code></pre></td></tr></table>
</div>
</div>
<p>计算曼哈顿距离</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">manhattan</span><span class="p">(</span><span class="n">rating1</span><span class="p">,</span> <span class="n">rating2</span><span class="p">):</span>
    <span class="s2">&#34;&#34;&#34;计算曼哈顿距离&#34;&#34;&#34;</span>
    <span class="n">distance</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">rating1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">rating2</span><span class="p">:</span>
            <span class="n">difference</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">rating1</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">-</span> <span class="n">rating2</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
            <span class="n">distance</span> <span class="o">+=</span> <span class="n">difference</span>
    <span class="k">return</span> <span class="n">distance</span></code></pre></td></tr></table>
</div>
</div>
<p>测试一下效果</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="n">manhattan</span><span class="p">(</span><span class="n">users</span><span class="p">[</span><span class="s1">&#39;Hailey&#39;</span><span class="p">],</span> <span class="n">users</span><span class="p">[</span><span class="s1">&#39;Veronica&#39;</span><span class="p">])</span>
<span class="mi">2</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">manhattan</span><span class="p">(</span><span class="n">users</span><span class="p">[</span><span class="s1">&#39;Hailey&#39;</span><span class="p">],</span> <span class="n">users</span><span class="p">[</span><span class="s1">&#39;Jordyn&#39;</span><span class="p">])</span>
<span class="mf">7.5</span></code></pre></td></tr></table>
</div>
</div>
<p>下面再通过一个函数，实现找出最近的用户距离，该函数会返回一个用户列表，按照距离排序</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">computeNearestNeighbor</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">users</span><span class="p">):</span>
    <span class="n">distances</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">user</span> <span class="o">!=</span> <span class="n">username</span><span class="p">:</span>
            <span class="n">distance</span> <span class="o">=</span> <span class="n">manhattan</span><span class="p">(</span><span class="n">users</span><span class="p">[</span><span class="n">username</span><span class="p">],</span> <span class="n">users</span><span class="p">[</span><span class="n">user</span><span class="p">])</span>
            <span class="n">distances</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">distance</span><span class="p">,</span> <span class="n">user</span><span class="p">))</span>
    <span class="n">distances</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">distances</span></code></pre></td></tr></table>
</div>
</div>
<p>测试一下，计算与用户Hailey最相似的用户</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="n">computeNearestNeighbor</span><span class="p">(</span><span class="s1">&#39;Hailey&#39;</span><span class="p">,</span> <span class="n">users</span><span class="p">)</span>
<span class="p">[(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Veronica&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;Chan&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;Sam&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="mf">4.5</span><span class="p">,</span> <span class="s1">&#39;Dan&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="mf">5.0</span><span class="p">,</span> <span class="s1">&#39;Angelica&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="mf">5.5</span><span class="p">,</span> <span class="s1">&#39;Bill&#39;</span><span class="p">),</span>
 <span class="p">(</span><span class="mf">7.5</span><span class="p">,</span> <span class="s1">&#39;Jordyn&#39;</span><span class="p">)]</span></code></pre></td></tr></table>
</div>
</div>
<p>最后再来根据距离做推荐</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">recommend</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">users</span><span class="p">):</span>
    <span class="c1"># 找到距离最近的用户</span>
    <span class="n">nearest</span> <span class="o">=</span> <span class="n">computeNearestNeighbor</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">users</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">recommendations</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># 找出这位用户评价过，但自己未评价过的乐队</span>
    <span class="n">neighborRatings</span> <span class="o">=</span> <span class="n">users</span><span class="p">[</span><span class="n">nearest</span><span class="p">]</span>
    <span class="n">userRatings</span> <span class="o">=</span> <span class="n">users</span><span class="p">[</span><span class="n">username</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">artist</span> <span class="ow">in</span> <span class="n">neighborRatings</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">artist</span> <span class="ow">in</span> <span class="n">userRatings</span><span class="p">:</span>
            <span class="n">recommendations</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">artist</span><span class="p">,</span> <span class="n">neighborRatings</span><span class="p">[</span><span class="n">artist</span><span class="p">]))</span>
    <span class="c1"># 按照评分进行排序</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">recommendations</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">recommend</span><span class="p">:</span> <span class="n">recommend</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></code></pre></td></tr></table>
</div>
</div>
<p>为用户Hailey做推荐</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="o">&gt;&gt;&gt;</span> <span class="n">recommend</span><span class="p">(</span><span class="s1">&#39;Hailey&#39;</span><span class="p">,</span> <span class="n">users</span><span class="p">)</span>
<span class="p">[(</span><span class="s1">&#39;Phoenix&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Blues Traveler&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;Slightly Stoopid&#39;</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">)]</span></code></pre></td></tr></table>
</div>
</div>
<p>闵科夫斯基算法</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">minkowski</span><span class="p">(</span><span class="n">rating1</span><span class="p">,</span> <span class="n">rating2</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
    <span class="s2">&#34;&#34;&#34;闵可夫斯基算法&#34;&#34;&#34;</span>
    <span class="n">distance</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">rating1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">rating2</span><span class="p">:</span>
            <span class="n">distance</span> <span class="o">+=</span> <span class="nb">pow</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">rating1</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">-</span> <span class="n">rating2</span><span class="p">[</span><span class="n">key</span><span class="p">]),</span> <span class="n">r</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">pow</span><span class="p">(</span><span class="n">distance</span><span class="p">,</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">r</span><span class="p">)</span></code></pre></td></tr></table>
</div>
</div>
<p>皮尔逊系数</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">pearson</span><span class="p">(</span><span class="n">rating1</span><span class="p">,</span> <span class="n">rating2</span><span class="p">):</span>
    <span class="n">sum_xy</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">sum_x</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">sum_y</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">sum_x2</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">sum_y2</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">rating1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">rating2</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">rating1</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">rating2</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="n">sum_xy</span> <span class="o">+=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span>
            <span class="n">sum_x</span> <span class="o">+=</span> <span class="n">x</span>
            <span class="n">sum_y</span> <span class="o">+=</span> <span class="n">y</span>
            <span class="n">sum_x2</span> <span class="o">+=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">sum_y2</span> <span class="o">+=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="c1"># now compute denominator</span>
    <span class="n">denominator</span> <span class="o">=</span> <span class="p">(</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sum_x2</span> <span class="o">-</span> <span class="nb">pow</span><span class="p">(</span><span class="n">sum_x</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">n</span><span class="p">)</span>
                   <span class="o">*</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">sum_y2</span> <span class="o">-</span> <span class="nb">pow</span><span class="p">(</span><span class="n">sum_y</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">n</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">denominator</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">sum_xy</span> <span class="o">-</span> <span class="p">(</span><span class="n">sum_x</span> <span class="o">*</span> <span class="n">sum_y</span><span class="p">)</span> <span class="o">/</span> <span class="n">n</span><span class="p">)</span> <span class="o">/</span> <span class="n">denominator</span></code></pre></td></tr></table>
</div>
</div>
<h3 id="相似度算法选择">相似度算法选择</h3>

<p>根据数据的特性，不同的算法计算的结果会有偏差，但是大体上满足如下规律:</p>

<ul>
<li>如果数据存在&rdquo;分数膨胀&rdquo;，就使用皮尔逊相关系数</li>
<li>如果数据比较密集，变量之间基本存在公有值，且这些距离数据都是非常重要的，那就使用曼哈顿距离或欧几里得距离</li>
<li>如果数据是稀释的，就用余弦定理</li>
</ul>

<h3 id="距离计算库">距离计算库</h3>

<p><a href="https://docs.scipy.org/doc/scipy/reference/spatial.distance.html"><code>scipy.spatial.distance</code></a>模块包含了各种距离的计算方式。</p>

<ul>
<li>scipy.spatial.distance.cityblock 曼哈顿距离</li>
<li>scipy.spatial.distance.euclidean 欧几里得距离</li>
<li>scipy.spatial.distance.chebyshev 切比雪夫距离</li>
<li>scipy.spatial.distance.minkowski 闵可夫斯基距离</li>
<li>scipy.stats.pearsonr 皮尔逊相关系数</li>
</ul>

<h3 id="k最邻近算法">K最邻近算法</h3>

<p>如果只使用最相似的一个用户来做推荐，如果这个用户有特殊的偏好，就会直接反应在推荐内容里。解决方法之一就是寻找多个相似的用户，这里就要用到K最邻近算法了。</p>

<p>完整实现请参考:</p>

<p><a href="https://github.com/zacharski/pg2dm-python/blob/master/ch2/recommender.py">https://github.com/zacharski/pg2dm-python/blob/master/ch2/recommender.py</a></p>
    </div>

    
    
<div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">crazygit</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">2018-01-22</span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">许可协议</span>
    <span class="item-content"><a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/deed.zh" target="_blank">CC BY-NC-ND 4.0</a></span>
  </p>
</div>

    
    
<div class="post-reward">
  <input type="checkbox" name="reward" id="reward" hidden />
  <label class="reward-button" for="reward">赞赏支持</label>
  <div class="qr-code">
    
    
      <label class="qr-code-image" for="reward">
        <img class="image" src="http://images.wiseturtles.com/wechatpay.jpg">
        <span>微信打赏</span>
      </label>
    
  </div>
</div>

    <footer class="post-footer">
      <div class="post-tags">
          <a href="https://crazygit.wiseturtles.com/tags/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/">推荐系统</a>
          <a href="https://crazygit.wiseturtles.com/tags/%E7%9B%B8%E4%BC%BC%E5%BA%A6%E8%AE%A1%E7%AE%97/">相似度计算</a>
          
        </div>

      
      <nav class="post-nav">
        
          <a class="prev" href="/2018/01/26/smarter-faster-better/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">《高效的秘密》读书文摘</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        
          <a class="next" href="/2018/01/19/pearson-correlation-coefficient/">
            <span class="next-text nav-default">皮尔逊相关系数(Pearson Correlation Coefficient)</span>
            <span class="prev-text nav-mobile">下一篇</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>

  
  

  
  
    <div class="post bg-white">
      <script src="https://utteranc.es/client.js"
            repo= "crazygit/hugo-blog-comments"
            issue-term="pathname"
            crossorigin="anonymous"
            async>
      </script>
    </div>
  

  

  

  

        </div>
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="mailto:crazygit@foxmail.com" rel="me noopener" class="iconfont icon-email"
        title="email" target="_blank">
      </a>
      <a href="https://twitter.com/lianglin999" rel="me noopener" class="iconfont icon-twitter"
        title="twitter" target="_blank">
      </a>
      <a href="https://github.com/crazygit" rel="me noopener" class="iconfont icon-github"
        title="github" target="_blank">
      </a>
      <a href="https://www.weibo.com/crazygit/profile" rel="me noopener" class="iconfont icon-weibo"
        title="weibo" target="_blank">
      </a>
  <a href="https://crazygit.wiseturtles.com/index.xml" rel="noopener alternate" type="application/rss&#43;xml" class="iconfont icon-rss"
    title="rss" target="_blank">
  </a>
  </div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - <a class="theme-link" href="https://github.com/xianmin/hugo-theme-jane">Jane</a>
  </span>

  <span class="copyright-year">
    &copy;
    
      2017 -
    2018
    <span class="heart">
      <i class="iconfont icon-heart"></i>
    </span><span class="author">
        crazygit
        
      </span></span>

  
  
    <span id="busuanzi_container">
      访客数/访问量：<span id="busuanzi_value_site_uv"></span>/<span id="busuanzi_value_site_pv"></span>
    </span>
  
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
<script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>
<script type="text/javascript" src="/dist/jane.min.js?v=2.7.0"></script>
  <script type="text/javascript">
    window.MathJax = {
      showProcessingMessages: false,
      messageStyle: 'none'
    };
  </script>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML' async></script><script id="baidu_analytics">
  var _hmt = _hmt || [];
  (function() {
    if (window.location.hostname === 'localhost') return;
    var hm = document.createElement("script"); hm.async = true;
    hm.src = "https://hm.baidu.com/hm.js?2b47f91b8532d1a5e950c8e77142d95c";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
  })();
</script>

<script id="baidu_push">
  (function(){
    if (window.location.hostname === 'localhost') return;
    var bp = document.createElement('script'); bp.async = true;
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
      bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
      bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
  })();
</script>



  
    <script type="text/javascript" src="/js/load-photoswipe.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe.min.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe-ui-default.min.js"></script>
  




  <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>




  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script type="text/javascript">
    AV.initialize("bWUs89CHYswTxwt88Jf71tIF-gzGzoHsz", "IcudhQhVD2eqKqkOTQQ6agUS");
  </script>

  <script>
    function showHitCount(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push($(this).attr("id").trim());
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var hits = item.get('hits');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(hits);
          }
          for (var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if (countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function (results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("hits");
            counter.save(null, {
              success: function (counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('hits'));
              },
              error: function (counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
             
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
             
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("hits", 1);
            newcounter.save(null, {
              success: function (newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('hits'));
              },
              error: function (newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function (error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function () {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        
        addCount(Counter);
      } else if ($('.post-link').length > 1) {
        
        showHitCount(Counter);
      }
    });
  </script>




  <script src="/js/douban.js"></script>


</body>
</html>
